var app=angular.module("app",["ngResource","ngRoute"]);angular.module("app").controller("LoginCtrl",["$scope","UserSvc","$location",function(e,r,t){var o={username:"",password:""};e.user=Object.create(o),e.login=function(){e.user&&""!=e.user.username&&""!=e.user.password&&(console.log(e.user),r.login(e.user.username,e.user.password,function(r,t){401==t&&(e.error=r.missatge)}).success(function(){r.getUser().then(function(r){e.$emit("login",r.data),t.path("/")})}))}}]),angular.module("app").controller("RegistrarCtrl",["$scope","UserSvc","$location",function(e,r,t){var o={username:"",password:"",password2:""};e.dadesRegistre=Object.create(o),e.sonIguals=function(){return e.dadesRegistre.password===e.dadesRegistre.password2?!0:(e.Register.$valid=!1,console.log(e.Register.$valid),!1)},e.registrar=function(){e.dadesRegistre.password&&e.dadesRegistre.password2&&e.dadesRegistre.username?e.dadesRegistre.password===e.dadesRegistre.password2?(console.log(e.dadesRegistre),r.registre(e.dadesRegistre.username,e.dadesRegistre.password).success(function(){t.path("/login")}).error(function(r,t){409==t&&(e.error=r.missatge),e.dadesRegistre.username=""})):e.error="Les contrasenyes no s√≥n iguals":e.error="Has d'emplenar tots els camps"}}]),angular.module("app").controller("afegirllibre",["$scope","LlibresFactory","$location",function(e,r,t){var o={titol:"",isbn:"",autors:[],date:new Date};e.llibre=Object.create(o),e.addLlibre=function(){e.llibre&&""!=e.llibre.titol&&""!=e.llibre.isbn&&r.save(e.llibre,function(){console.log("s'ha guardat"),t.path("/")},function(e){console.log("Error"+e)})},e.netejarCamps=function(){e.llibre=null}}]),angular.module("app").controller("editarllibre",["$scope","LlibresFactory","$rootScope","$location",function(e,r,t,o){t.llibreToEdit&&(e.llibre=t.llibreToEdit),e.updateLlibre=function(){e.llibre&&""!=e.llibre.titol&&""!=e.llibre.isbn&&r.update(e.llibre,function(){console.log("updated"),o.path("/")})},e.netejarCamps=function(){e.llibre&&(e.llibre=null,t.llibreToEdit=null)}}]),angular.module("app").controller("LlibreCtrl",["$scope","$location","UserSvc",function(e,r,t){e.$on("login",function(r,t){e.currentUser=t}),e.logout=function(){t.logOut(),delete e.currentUser,r.path("/")}}]),angular.module("app").factory("LlibresFactory",["$resource",function(e){return e("/api/llibres/:id",null,{update:{method:"PUT"}})}]),angular.module("app").controller("llistallibre",["$scope","LlibresFactory","$rootScope","$location",function(e,r,t,o){e.llibres=[],e.loading=!0,e.llibres=r.query(function(r){e.llibres=r,e.loading=!1}),e.removeLlibre=function(t){t&&r["delete"]({id:e.llibres[t].isbn},function(){e.llibres.splice(t,1)})},e.editarLlibre=function(r){t.llibreToEdit=e.llibres[r],o.path("/editarllibre")}}]),angular.module("app").config(["$routeProvider","$locationProvider",function(e){e.when("/",{controller:"llistallibre",templateUrl:"llista.html",autoritzat:!1}).when("/noullibre",{controller:"afegirllibre",templateUrl:"afegir.html",autoritzat:!0}).when("/editarllibre",{controller:"editarllibre",templateUrl:"edicio.html",autoritzat:!0}).when("/registrar",{controller:"RegistrarCtrl",templateUrl:"registrar.html",autoritzat:!1}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html",autoritzat:!1}).otherwise({redirectTo:"/"})}]).run(["$rootScope","UserSvc","$location",function(e,r,t){e.$on("$routeChangeStart",function(e,o){o&&!r.auth&o.autoritzat&&t.path("/login")})}]),angular.module("app").service("UserSvc",["$http",function(e){var r=this;r.auth=!1,r.getUser=function(){return e.get("/api/users")},r.login=function(t,o,l){return e.post("/api/sessions",{username:t,password:o}).success(function(t){e.defaults.headers.common["x-auth"]=t,t&&(r.auth=!0)}).error(function(e,r){l(e,r)})},this.registre=function(r,t){return e.post("/api/users",{username:r,password:t})},this.logOut=function(){r.auth=!1,e.defaults.headers.common["x-auth"]=""}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsIkxvZ2luQ3RybC5qcyIsIlJlZ2lzdHJhckN0cmwuanMiLCJhZmVnaXJsbGlicmUuY3RybC5qcyIsImVkaXRhcmxsaWJyZS5jdHJsLmpzIiwibGxpYnJlcy5jdHJsLmpzIiwibGxpYnJlcy5mYWN0b3J5cy5qcyIsImxsaXN0YS5jdHJsLmpzIiwicm91dGVzLmpzIiwidXNlcnMuZmFjdG9yeXMuanMiXSwibmFtZXMiOlsiYXBwIiwiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCJVc2VyU3ZjIiwiJGxvY2F0aW9uIiwidXNlciIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJPYmplY3QiLCJjcmVhdGUiLCJsb2dpbiIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsInN0YXR1cyIsIm1pc3NhdGdlIiwic3VjY2VzcyIsImdldFVzZXIiLCJ0aGVuIiwiJGVtaXQiLCJkYXRhIiwicGF0aCIsImRhZGVzUmVnaXN0cmUiLCJwYXNzd29yZDIiLCJzb25JZ3VhbHMiLCJSZWdpc3RlciIsIiR2YWxpZCIsInJlZ2lzdHJhciIsInJlZ2lzdHJlIiwiTGxpYnJlc0ZhY3RvcnkiLCJsbGlicmUiLCJ0aXRvbCIsImlzYm4iLCJhdXRvcnMiLCJkYXRlIiwiRGF0ZSIsImFkZExsaWJyZSIsInNhdmUiLCJuZXRlamFyQ2FtcHMiLCIkcm9vdFNjb3BlIiwibGxpYnJlVG9FZGl0IiwidXBkYXRlTGxpYnJlIiwidXBkYXRlIiwiJG9uIiwiZSIsImN1cnJlbnRVc2VyIiwibG9nb3V0IiwibG9nT3V0IiwiZmFjdG9yeSIsIiRyZXNvdXJjZSIsIm1ldGhvZCIsImxsaWJyZXMiLCJsb2FkaW5nIiwicXVlcnkiLCJlbnRyaWVzIiwicmVtb3ZlTGxpYnJlIiwiaW5kZXgiLCJpZCIsInNwbGljZSIsImVkaXRhckxsaWJyZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiYXV0b3JpdHphdCIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCJydW4iLCJldmVudCIsIm5leHQiLCJhdXRoIiwic2VydmljZSIsIiRodHRwIiwic3J2IiwidGhpcyIsImdldCIsIm5vTG9naW4iLCJwb3N0IiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLE9BQUEsYUFBQSxXQ0FBRCxTQUFBQyxPQUFBLE9BQ0FDLFdBQUEsYUFBQSxTQUFBLFVBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUVBLEdBQUFDLElBQ0FDLFNBQUEsR0FDQUMsU0FBQSxHQUVBTCxHQUFBRyxLQUFBRyxPQUFBQyxPQUFBSixHQUNBSCxFQUFBUSxNQUFBLFdBRUFSLEVBQUFHLE1BQ0EsSUFBQUgsRUFBQUcsS0FBQUMsVUFBQSxJQUFBSixFQUFBRyxLQUFBRSxXQUNBSSxRQUFBQyxJQUFBVixFQUFBRyxNQUNBRixFQUFBTyxNQUFBUixFQUFBRyxLQUFBQyxTQUFBSixFQUFBRyxLQUFBRSxTQUNBLFNBQUFNLEVBQUFDLEdBSUEsS0FBQUEsSUFDQVosRUFBQVcsTUFBQUEsRUFBQUUsWUFFQUMsUUFBQSxXQUNBYixFQUFBYyxVQUFBQyxLQUFBLFNBQUFiLEdBT0FILEVBQUFpQixNQUFBLFFBQUFkLEVBQUFlLE1BQ0FoQixFQUFBaUIsS0FBQSxjQzlCQXRCLFFBQUFDLE9BQUEsT0FDQUMsV0FBQSxpQkFBQSxTQUFBLFVBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFrQixJQUNBaEIsU0FBQSxHQUNBQyxTQUFBLEdBQ0FnQixVQUFBLEdBSUFyQixHQUFBb0IsY0FBQWQsT0FBQUMsT0FBQWEsR0FDQXBCLEVBQUFzQixVQUFBLFdBRUEsTUFBQXRCLEdBQUFvQixjQUFBZixXQUFBTCxFQUFBb0IsY0FBQUMsV0FDQSxHQUVBckIsRUFBQXVCLFNBQUFDLFFBQUEsRUFDQWYsUUFBQUMsSUFBQVYsRUFBQXVCLFNBQUFDLFNBQ0EsSUFJQXhCLEVBQUF5QixVQUFBLFdBQ0F6QixFQUFB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SUFFQUYsS0FBQSxjQUNBN0QsV0FBQSxlQUNBOEQsWUFBQSxjQUNBQyxZQUFBLElBRUFGLEtBQUEsaUJBQ0E3RCxXQUFBLGVBQ0E4RCxZQUFBLGNBQ0FDLFlBQUEsSUFFQUYsS0FBQSxjQUNBN0QsV0FBQSxnQkFDQThELFlBQUEsaUJBQ0FDLFlBQUEsSUFFQUYsS0FBQSxVQUNBN0QsV0FBQSxZQUNBOEQsWUFBQSxhQUNBQyxZQUFBLElBRUFDLFdBQ0FDLFdBQUEsU0FRQUMsS0FBQSxhQUFBLFVBQUEsWUFBQSxTQUFBNUIsRUFBQXBDLEVBQUFDLEdBQ0FtQyxFQUFBSSxJQUFBLG9CQUFBLFNBQUF5QixFQUFBQyxHQUNBQSxJQUNBbEUsRUFBQW1FLEtBQUFELEVBQUFMLFlBQ0E1RCxFQUFBaUIsS0FBQSxlQ3pDQXRCLFFBQUFDLE9BQUEsT0FRQXVFLFFBQUEsV0FBQSxRQUFBLFNBQUFDLEdBQ0EsR0FBQUMsR0FBQUMsSUFDQUQsR0FBQUgsTUFBQSxFQUNBRyxFQUFBeEQsUUFBQSxXQUNBLE1BQUF1RCxHQUFBRyxJQUFBLGVBRUFGLEVBQUEvRCxNQUFBLFNBQUFKLEVBQUFDLEVBQUFxRSxHQUNBLE1BQUFKLEdBQUFLLEtBQUEsaUJBQ0F2RSxTQUFBQSxFQUNBQyxTQUFBQSxJQUNBUyxRQUFBLFNBQUFJLEdBTUFvRCxFQUFBTSxTQUFBQyxRQUFBQyxPQUFBLFVBQUE1RCxFQUNBQSxJQUFBcUQsRUFBQUgsTUFBQSxLQUNBekQsTUFBQSxTQUFBQSxFQUFBQyxHQUtBOEQsRUFBQS9ELEVBQUFDLE1BR0E0RCxLQUFBOUMsU0FBQSxTQUFBdEIsRUFBQUMsR0FLQSxNQUFBaUUsR0FBQUssS0FBQSxjQUNBdkUsU0FBQUEsRUFDQUMsU0FBQUEsS0FHQW1FLEtBQUEzQixPQUFBLFdBS0EwQixFQUFBSCxNQUFBLEVBQ0FFLEVBQUFNLFNBQUFDLFFBQUFDLE9BQUEsVUFBQSIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFsnbmdSZXNvdXJjZScsJ25nUm91dGUnXSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbnRyb2xsZXIoJ0xvZ2luQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSAsIFVzZXJTdmMgLCAkbG9jYXRpb24pIHtcbiAgICAvLyBjb25zb2xlLmxvZygnTG9naW4hISEnKTtcbiAgICB2YXIgdXNlciA9IHtcbiAgICAgIHVzZXJuYW1lOiBcIlwiLFxuICAgICAgcGFzc3dvcmQ6IFwiXCJcbiAgICB9XG4gICAgJHNjb3BlLnVzZXIgPSBPYmplY3QuY3JlYXRlKHVzZXIpO1xuICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgLy9mYSBmYWx0YSBjb21wcm92YXItaG8gPz8/XG4gICAgICBpZiAoJHNjb3BlLnVzZXIpIHtcbiAgICAgICAgaWYgKCRzY29wZS51c2VyLnVzZXJuYW1lICE9IFwiXCIgJiYgJHNjb3BlLnVzZXIucGFzc3dvcmQgIT0gXCJcIikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS51c2VyKTtcbiAgICAgICAgICBVc2VyU3ZjLmxvZ2luKCRzY29wZS51c2VyLnVzZXJuYW1lLCAkc2NvcGUudXNlci5wYXNzd29yZCxcbiAgICAgICAgICAgIGZ1bmN0aW9uKGVycm9yLCBzdGF0dXMpIHtcbiAgICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICAgIEZ1bmNpw7MgcXVlIHMnZXhlY3V0YXLDoCBzaSBoaSBoYSB1biBlcnJvciBlbiBlbCBsb2dpblxuICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBpZiAoc3RhdHVzID09IDQwMSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IGVycm9yLm1pc3NhdGdlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgVXNlclN2Yy5nZXRVc2VyKCkudGhlbihmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICBTaSB0b3QgdmEgYsOpLCBhbmVtIGEgbGEgcMOgZ2luYSBwcmluY2lwYWxcbiAgICAgICAgICAgICAgICAgIGkgZW1ldGVuIHVuIG1pc3NhdGdlIGRlIFwibG9naW5cIiBwZXIgYXZpc2FyXG4gICAgICAgICAgICAgICAgICBhIGxhIG5vc3RyYSBhcHAgcXVlIGwndXN1YXJpIGhhIGZldCBsb2dpblxuICAgICAgICAgICAgICAgICAgY29ycmVjdGFtZW50LlxuICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAkc2NvcGUuJGVtaXQoJ2xvZ2luJywgdXNlci5kYXRhKTtcbiAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbnRyb2xsZXIoJ1JlZ2lzdHJhckN0cmwnLCBmdW5jdGlvbigkc2NvcGUgLCBVc2VyU3ZjICwgJGxvY2F0aW9uKSB7XG4gICAgdmFyIGRhZGVzUmVnaXN0cmUgPSB7XG4gICAgICB1c2VybmFtZSA6IFwiXCIsXG4gICAgICBwYXNzd29yZCA6IFwiXCIsXG4gICAgICBwYXNzd29yZDI6IFwiXCJcbiAgICB9O1xuXG5cbiAgICAkc2NvcGUuZGFkZXNSZWdpc3RyZSA9IE9iamVjdC5jcmVhdGUoZGFkZXNSZWdpc3RyZSk7XG4gICAgJHNjb3BlLnNvbklndWFscyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS5SZWdpc3Rlci4kdmFsaWQpO1xuICAgICAgaWYgKCRzY29wZS5kYWRlc1JlZ2lzdHJlLnBhc3N3b3JkID09PSAkc2NvcGUuZGFkZXNSZWdpc3RyZS5wYXNzd29yZDIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1lbHNle1xuICAgICAgICAkc2NvcGUuUmVnaXN0ZXIuJHZhbGlkID0gZmFsc2U7XG4gICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5SZWdpc3Rlci4kdmFsaWQpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgJHNjb3BlLnJlZ2lzdHJhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICghJHNjb3BlLmRhZGVzUmVnaXN0cmUucGFzc3dvcmQgfHwgISRzY29wZS5kYWRlc1JlZ2lzdHJlLnBhc3N3b3JkMiB8fCAhJHNjb3BlLmRhZGVzUmVnaXN0cmUudXNlcm5hbWUpIHtcbiAgICAgICAgJHNjb3BlLmVycm9yID0gXCJIYXMgZCdlbXBsZW5hciB0b3RzIGVscyBjYW1wc1wiO1xuICAgICAgfSBlbHNlIGlmICgkc2NvcGUuZGFkZXNSZWdpc3RyZS5wYXNzd29yZCA9PT0gJHNjb3BlLmRhZGVzUmVnaXN0cmUucGFzc3dvcmQyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5kYWRlc1JlZ2lzdHJlKTtcblxuICAgICAgICBVc2VyU3ZjLnJlZ2lzdHJlKCRzY29wZS5kYWRlc1JlZ2lzdHJlLnVzZXJuYW1lLCAkc2NvcGUuZGFkZXNSZWdpc3RyZS5wYXNzd29yZClcbiAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZXJyb3IsIHN0YXR1cykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSA0MDkpXG4gICAgICAgICAgICAgICRzY29wZS5lcnJvciA9IGVycm9yLm1pc3NhdGdlO1xuICAgICAgICAgICAgICAkc2NvcGUuZGFkZXNSZWdpc3RyZS51c2VybmFtZSA9IFwiXCI7XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkc2NvcGUuZXJyb3IgPSBcIkxlcyBjb250cmFzZW55ZXMgbm8gc8OzbiBpZ3VhbHNcIjtcbiAgICAgIH1cbiAgICB9XG5cbiAgfSlcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAuY29udHJvbGxlcignYWZlZ2lybGxpYnJlJywgZnVuY3Rpb24oJHNjb3BlLCBMbGlicmVzRmFjdG9yeSwgJGxvY2F0aW9uKSB7XG4gICAgdmFyIGxsaWJyZSA9IHtcbiAgICAgIHRpdG9sOiBcIlwiLFxuICAgICAgaXNibjogXCJcIixcbiAgICAgIGF1dG9yczogW10sXG4gICAgICBkYXRlOiBuZXcgRGF0ZSgpXG4gICAgfVxuICAgICRzY29wZS5sbGlicmUgPSBPYmplY3QuY3JlYXRlKGxsaWJyZSk7XG5cbiAgICAkc2NvcGUuYWRkTGxpYnJlID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoJHNjb3BlLmxsaWJyZSkge1xuICAgICAgICBpZiAoJHNjb3BlLmxsaWJyZS50aXRvbCAhPSBcIlwiICYmICRzY29wZS5sbGlicmUuaXNibiAhPSBcIlwiKSB7XG4gICAgICAgICAgTGxpYnJlc0ZhY3Rvcnkuc2F2ZSgkc2NvcGUubGxpYnJlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicydoYSBndWFyZGF0XCIpO1xuICAgICAgICAgICAgLy8kc2NvcGUubmV0ZWphckNhbXBzKCk7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCggXCIvXCIgKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvclwiICsgZXJyb3IpO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUubmV0ZWphckNhbXBzID0gZnVuY3Rpb24oKSB7XG4gICAgICAkc2NvcGUubGxpYnJlID0gbnVsbDtcbiAgICB9XG4gIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbnRyb2xsZXIoJ2VkaXRhcmxsaWJyZScsIGZ1bmN0aW9uKCRzY29wZSwgTGxpYnJlc0ZhY3RvcnksICRyb290U2NvcGUgLCAkbG9jYXRpb24pIHtcblxuICAgIGlmICgkcm9vdFNjb3BlLmxsaWJyZVRvRWRpdCkge1xuICAgICAgJHNjb3BlLmxsaWJyZSA9ICRyb290U2NvcGUubGxpYnJlVG9FZGl0O1xuICAgIH1cbiAgICAkc2NvcGUudXBkYXRlTGxpYnJlID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZigkc2NvcGUubGxpYnJlKXtcbiAgICAgICAgaWYgKCRzY29wZS5sbGlicmUudGl0b2wgIT0gXCJcIiAmJiAkc2NvcGUubGxpYnJlLmlzYm4gIT0gXCJcIikge1xuICAgICAgICAgIExsaWJyZXNGYWN0b3J5LnVwZGF0ZSgkc2NvcGUubGxpYnJlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGVkJylcbiAgICAgICAgICAgIC8vJHNjb3BlLm5ldGVqYXJDYW1wcygpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoIFwiL1wiICk7XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUubmV0ZWphckNhbXBzID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZigkc2NvcGUubGxpYnJlKXtcbiAgICAgICAgJHNjb3BlLmxsaWJyZSA9IG51bGw7XG4gICAgICAgICRyb290U2NvcGUubGxpYnJlVG9FZGl0ID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbnRyb2xsZXIoJ0xsaWJyZUN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgVXNlclN2Yykge1xuICAgICRzY29wZS4kb24oJ2xvZ2luJywgZnVuY3Rpb24oZSwgdXNlcikge1xuICAgICAgLypcbiAgICAgICAgICBRdWFuIHMnaGEgZmV0IGxvZ2luIHMnZW1ldCBsJ2V2ZW50IFwibG9naW5cIlxuICAgICAgICAgIGkgYWl4w7IgZmEgcXVlIGxhIHZhcmlhYmxlIGRlIGwnc2NvcGUgXCJjdXJyZW50VXNlclwiXG4gICAgICAgICAgbGkgZGllbSBxdWluIHVzdWFyaSBzJ2hhIGF1dGVudGljYW50LCBkJ2FxdWVzdGEgbWFuZXJhXG4gICAgICAgICAgZmVtIHF1ZSBhcGFyZWd1aW4gZGlmZXJlbnRzIG9wY2lvbnMgYWwgbWVuw7pcbiAgICAgICovXG4gICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgIH0pO1xuICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgIC8qXG4gICAgICAgICAgUXVhbiBmZW0gbG9nb3V0IGVzYm9ycmVtIGVsIHRva2VuIGkgbGEgdmFyaWFibGVcbiAgICAgICAgICBkZSBsJyRzY29wZSBcImN1cnJlbnRVc2VyXCIsIGQnYXF1ZXN0YSBmb3JtYSBkZXNhcGFyZWl4ZW5cbiAgICAgICAgICBlbHMgbWVuw7pzIHNlbnNpYmxlcyBhIGxhIGF1dGVudGljYWNpw7NcbiAgICAgICovXG4gICAgICBVc2VyU3ZjLmxvZ091dCgpO1xuICAgICAgZGVsZXRlICRzY29wZS5jdXJyZW50VXNlcjtcbiAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgfTtcbiAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmZhY3RvcnkoJ0xsaWJyZXNGYWN0b3J5JywgZnVuY3Rpb24oJHJlc291cmNlKSB7XG4gICAgcmV0dXJuICRyZXNvdXJjZShcIi9hcGkvbGxpYnJlcy86aWRcIiwgbnVsbCwge1xuICAgICAgJ3VwZGF0ZSc6IHtcbiAgICAgICAgbWV0aG9kOiAnUFVUJ1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAuY29udHJvbGxlcignbGxpc3RhbGxpYnJlJywgZnVuY3Rpb24oJHNjb3BlLCBMbGlicmVzRmFjdG9yeSAsICRyb290U2NvcGUgLCAkbG9jYXRpb24pIHtcbiAgICAkc2NvcGUubGxpYnJlcyA9IFtdO1xuICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAkc2NvcGUubGxpYnJlcyA9IExsaWJyZXNGYWN0b3J5LnF1ZXJ5KGZ1bmN0aW9uKGVudHJpZXMpIHtcbiAgICAgICRzY29wZS5sbGlicmVzID0gZW50cmllcztcbiAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUucmVtb3ZlTGxpYnJlID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgIGlmIChpbmRleCkge1xuICAgICAgICBMbGlicmVzRmFjdG9yeS5kZWxldGUoe1xuICAgICAgICAgIGlkOiAkc2NvcGUubGxpYnJlc1tpbmRleF0uaXNiblxuICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAkc2NvcGUubGxpYnJlcy5zcGxpY2UoaW5kZXgsMSk7XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICAgICRzY29wZS5lZGl0YXJMbGlicmUgPSBmdW5jdGlvbiAoaW5kZXgpe1xuICAgICAgJHJvb3RTY29wZS5sbGlicmVUb0VkaXQgPSAkc2NvcGUubGxpYnJlc1tpbmRleF07XG4gICAgICAkbG9jYXRpb24ucGF0aCggXCIvZWRpdGFybGxpYnJlXCIgKTtcbiAgICB9XG4gIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAkcm91dGVQcm92aWRlclxuICAgICAgLndoZW4oXCIvXCIsIHtcbiAgICAgICAgY29udHJvbGxlcjogJ2xsaXN0YWxsaWJyZScsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbGxpc3RhLmh0bWwnLFxuICAgICAgICBhdXRvcml0emF0OiBmYWxzZVxuICAgICAgfSlcbiAgICAgIC53aGVuKFwiL25vdWxsaWJyZVwiLCB7XG4gICAgICAgIGNvbnRyb2xsZXI6IFwiYWZlZ2lybGxpYnJlXCIsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYWZlZ2lyLmh0bWwnLFxuICAgICAgICBhdXRvcml0emF0OiB0cnVlXG4gICAgICB9KVxuICAgICAgLndoZW4oXCIvZWRpdGFybGxpYnJlXCIsIHtcbiAgICAgICAgY29udHJvbGxlcjogXCJlZGl0YXJsbGlicmVcIixcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdlZGljaW8uaHRtbCcsXG4gICAgICAgIGF1dG9yaXR6YXQ6IHRydWVcbiAgICAgIH0pXG4gICAgICAud2hlbihcIi9yZWdpc3RyYXJcIiwge1xuICAgICAgICBjb250cm9sbGVyOiBcIlJlZ2lzdHJhckN0cmxcIixcbiAgICAgICAgdGVtcGxhdGVVcmw6IFwicmVnaXN0cmFyLmh0bWxcIixcbiAgICAgICAgYXV0b3JpdHphdDogZmFsc2VcbiAgICAgIH0pXG4gICAgICAud2hlbihcIi9sb2dpblwiLCB7XG4gICAgICAgIGNvbnRyb2xsZXI6IFwiTG9naW5DdHJsXCIsXG4gICAgICAgIHRlbXBsYXRlVXJsOiBcImxvZ2luLmh0bWxcIixcbiAgICAgICAgYXV0b3JpdHphdDogZmFsc2VcbiAgICAgIH0pXG4gICAgICAub3RoZXJ3aXNlKHtcbiAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICB9KTtcblxuICAgIC8vICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh7XG4gICAgLy8gICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgIC8vICAgICAgICAgICAgICAgcmVxdWlyZUJhc2U6IGZhbHNlXG4gICAgLy8gICAgICAgICAgICAgfSk7XG4gIH0pXG4gIC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgVXNlclN2YywgJGxvY2F0aW9uKSB7XG4gICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oZXZlbnQsIG5leHQpIHtcbiAgICAgIGlmIChuZXh0KVxuICAgICAgICBpZiAoIVVzZXJTdmMuYXV0aCAmIG5leHQuYXV0b3JpdHphdClcbiAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9sb2dpblwiKTtcbiAgICAgICAgLy8gZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIH0pO1xuICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAvLyAuZmFjdG9yeSgnVXNlckZhY3RvcnknLCBmdW5jdGlvbigkcmVzb3VyY2UpIHtcbiAgLy8gICByZXR1cm4gJHJlc291cmNlKFwiL2FwaS91c2Vycy86aWRcIiwgbnVsbCwge1xuICAvLyAgICAgJ3VwZGF0ZSc6IHtcbiAgLy8gICAgICAgbWV0aG9kOiAnUFVUJ1xuICAvLyAgICAgfVxuICAvLyAgIH0pO1xuICAvLyB9KVxuICAuc2VydmljZSgnVXNlclN2YycsIGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgdmFyIHNydiA9IHRoaXM7XG4gICAgc3J2LmF1dGggPSBmYWxzZTtcbiAgICBzcnYuZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJyk7XG4gICAgfTtcbiAgICBzcnYubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkLCBub0xvZ2luKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb25zJywge1xuICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSxzdGF0dXMpIHtcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgU2kgbCdhdXRlbnRpY2FjacOzIMOpcyBjb3JyZWN0ZSBsaSBkaWVtIGEgbCdhbmd1bGFyIHF1ZSBjYWRhXG4gICAgICAgICAgICAgICAgdmVnYWRhIHF1ZSBlcyBjb211bmlxdWkgYW1iIGVsIHNlcnZpZG9yIGFmZWdlaXhpIGVsIHRva2VuXG4gICAgICAgICAgICAgICAgYWwgaGVhZGVyICd4LWF1dGgnXG4gICAgICAgICAgICAqL1xuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID0gZGF0YTtcbiAgICAgICAgICAgIGlmIChkYXRhKSBzcnYuYXV0aCA9IHRydWU7XG4gICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yLHN0YXR1cyl7XG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgIFNpIGwndXN1YXJpIGkgY29udHJhc2VueWEgbm8gw6lzIGNvcnJlY3RlIGV4ZWN1dGEgbGFcbiAgICAgICAgICAgICAgICBmdW5jacOzbiBjYWxsYmFjayBxdWUgbGkgaGVtIHBhc3NhdCBjb20gcGFyw6BtZXRyZVxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG5vTG9naW4oZXJyb3IsIHN0YXR1cyk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgdGhpcy5yZWdpc3RyZSA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgLypcbiAgICAgICAgICBQZXIgcmVnaXN0cmFyIHVuIHVzdWFyaSBub3UsIG5vbcOpcyBoZW0gZGUgZmVyIHVuIHBvc3RcbiAgICAgICAgICBhIGwnYXBpIGQndXN1YXJpc1xuICAgICAgKi9cbiAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzJywge1xuICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgfSk7XG4gICAgfTtcbiAgICB0aGlzLmxvZ091dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvKlxuICAgICAgICAgICAgUXVhbiBsJ3VzdWFyaSBmYSBsb2dvdXQgcydlc2JvcnJhIGVsIHRva2VuXG4gICAgICAgICAgICBpIHBvc2VtIGxhIHByb3BpZXRhdCBkZWwgc2VydmVpIFwiYXV0aFwiIGEgZmFsc2VcbiAgICAgICAgKi9cbiAgICAgICAgc3J2LmF1dGggPSBmYWxzZTtcbiAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID1cIlwiO1xuICAgIH07XG4gIH0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9