var app=angular.module("app",["ngResource","ngRoute"]);angular.module("app").controller("LoginCtrl",["$scope","UserSvc","$location",function(e,r,o){var t={username:"",password:""};e.user=Object.create(t),e.login=function(){e.user&&""!=e.user.username&&""!=e.user.password&&(console.log(e.user),r.login(e.user.username,e.user.password,function(r,o){401==o&&(e.error=r.missatge)}).success(function(){r.getUser().then(function(r){e.$emit("login",r.data),o.path("/")})}))}}]),angular.module("app").controller("RegistrarCtrl",["$scope","UserSvc","$location",function(e,r,o){var t={username:"",password:"",password2:""};e.dadesRegistre=Object.create(t),e.sonIguals=function(){return e.dadesRegistre.password===e.dadesRegistre.password2?!0:(e.Register.$valid=!1,console.log(e.Register.$valid),!1)},e.registrar=function(){e.dadesRegistre.password&&e.dadesRegistre.password2&&e.dadesRegistre.username?e.dadesRegistre.password===e.dadesRegistre.password2?(console.log(e.dadesRegistre),r.registre(e.dadesRegistre.username,e.dadesRegistre.password).success(function(){o.path("/login")}).error(function(r,o){409==o&&(e.error=r.missatge),e.dadesRegistre.username=""})):e.error="Les contrasenyes no s√≥n iguals":e.error="Has d'emplenar tots els camps"}}]),angular.module("app").controller("afegirllibre",["$scope","LlibresFactory","$location","AutorsFactory",function(e,r,o,t){var l={titol:"",isbn:"",autors:[],date:new Date};e.llibre=Object.create(l),e.addLlibre=function(){e.llibre&&""!=e.llibre.titol&&""!=e.llibre.isbn&&(e.llibre.autors=e.selected,console.log(e.llibre),r.save(e.llibre,function(){console.log("s'ha guardat"),o.path("/")},function(e){console.log("Error"+e)}))},e.netejarCamps=function(){e.llibre=null},t.query(function(r){e.Autors=r})}]),angular.module("app").controller("editarllibre",["$scope","LlibresFactory","$rootScope","$location",function(e,r,o,t){o.llibreToEdit&&(e.llibre=o.llibreToEdit),e.updateLlibre=function(){e.llibre&&""!=e.llibre.titol&&""!=e.llibre.isbn&&r.update(e.llibre,function(){console.log("updated"),t.path("/")})},e.netejarCamps=function(){e.llibre&&(e.llibre=null,o.llibreToEdit=null)}}]),angular.module("app").controller("LlibreCtrl",["$scope","$location","UserSvc",function(e,r,o){e.$on("login",function(r,o){e.currentUser=o}),e.logout=function(){o.logOut(),delete e.currentUser,r.path("/")}}]),angular.module("app").factory("LlibresFactory",["$resource",function(e){return e("/api/llibres/:id",null,{update:{method:"PUT"}})}]),angular.module("app").controller("llistallibre",["$scope","LlibresFactory","$rootScope","$location",function(e,r,o,t){e.llibres=[],e.loading=!0,e.llibres=r.query(function(r){e.llibres=r,e.loading=!1}),e.removeLlibre=function(o){console.log(e.currentUser),e.currentUser?o&&r["delete"]({id:e.llibres[o].isbn},function(){e.llibres.splice(o,1)}):t.path("/login")},e.editarLlibre=function(r){o.llibreToEdit=e.llibres[r],t.path("/editarllibre")}}]),angular.module("app").config(["$routeProvider","$locationProvider",function(e){e.when("/",{controller:"llistallibre",templateUrl:"llista.html",autoritzat:!1}).when("/noullibre",{controller:"afegirllibre",templateUrl:"afegir.html",autoritzat:!0}).when("/editarllibre",{controller:"editarllibre",templateUrl:"edicio.html",autoritzat:!0}).when("/registrar",{controller:"RegistrarCtrl",templateUrl:"registrar.html",autoritzat:!1}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html",autoritzat:!1}).when("/autors",{controller:"llistaAutors",templateUrl:"autor/llista.html",autoritzat:!1}).when("/NouAutor",{controller:"afegirAutor",templateUrl:"autor/afegir.html",autoritzat:!1}).otherwise({redirectTo:"/"})}]).run(["$rootScope","UserSvc","$location",function(e,r,o){e.$on("$routeChangeStart",function(e,t){t&&!r.auth&t.autoritzat&&o.path("/login")})}]),angular.module("app").service("UserSvc",["$http",function(e){var r=this;r.auth=!1,r.getUser=function(){return e.get("/api/users")},r.login=function(o,t,l){return e.post("/api/sessions",{username:o,password:t}).success(function(o){e.defaults.headers.common["x-auth"]=o,o&&(r.auth=!0)}).error(function(e,r){l(e,r)})},this.registre=function(r,o){return e.post("/api/users",{username:r,password:o})},this.logOut=function(){r.auth=!1,e.defaults.headers.common["x-auth"]=""}}]),angular.module("app").controller("afegirAutor",["$scope","AutorsFactory","$location",function(e,r,o){var t=new Date,l={nom:"",cognom:"",cognom2:[],any:t.getFullYear()};e.autor=Object.create(l),e.addAutor=function(){e.autor&&""!=e.autor.nom&&""!=e.autor.cognom&&r.save(e.autor,function(){console.log("s'ha guardat"),o.path("/autors")},function(e){console.log("Error"+e)})},e.netejarCamps=function(){e.autor=null}}]),angular.module("app").controller("llistaAutors",["$scope","AutorsFactory","$rootScope","$location",function(e,r){e.Autors=[],e.loading=!0,e.Autors=r.query(function(r){e.Autors=r,e.loading=!1})}]),angular.module("app").factory("AutorsFactory",["$resource",function(e){return e("/api/autors/:id",null,{update:{method:"PUT"}})}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsIkxvZ2luQ3RybC5qcyIsIlJlZ2lzdHJhckN0cmwuanMiLCJhZmVnaXJsbGlicmUuY3RybC5qcyIsImVkaXRhcmxsaWJyZS5jdHJsLmpzIiwibGxpYnJlcy5jdHJsLmpzIiwibGxpYnJlcy5mYWN0b3J5cy5qcyIsImxsaXN0YS5jdHJsLmpzIiwicm91dGVzLmpzIiwidXNlcnMuZmFjdG9yeXMuanMiLCJhdXRvcnMvYWZlZ2lyLWF1dG9yLmN0cmwuanMiLCJhdXRvcnMvYXV0b3JzLWxsaXN0YS5jdHJsLmpzIiwiYXV0b3JzL2F1dG9ycy5mYWN0b3J5LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiVXNlclN2YyIsIiRsb2NhdGlvbiIsInVzZXIiLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwiT2JqZWN0IiwiY3JlYXRlIiwibG9naW4iLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJzdGF0dXMiLCJtaXNzYXRnZSIsInN1Y2Nlc3MiLCJnZXRVc2VyIiwidGhlbiIsIiRlbWl0IiwiZGF0YSIsInBhdGgiLCJkYWRlc1JlZ2lzdHJlIiwicGFzc3dvcmQyIiwic29uSWd1YWxzIiwiUmVnaXN0ZXIiLCIkdmFsaWQiLCJyZWdpc3RyYXIiLCJyZWdpc3RyZSIsIkxsaWJyZXNGYWN0b3J5IiwiQXV0b3JzRmFjdG9yeSIsImxsaWJyZSIsInRpdG9sIiwiaXNibiIsImF1dG9ycyIsImRhdGUiLCJEYXRlIiwiYWRkTGxpYnJlIiwic2VsZWN0ZWQiLCJzYXZlIiwibmV0ZWphckNhbXBzIiwicXVlcnkiLCJlbnRyaWVzIiwiQXV0b3JzIiwiJHJvb3RTY29wZSIsImxsaWJyZVRvRWRpdCIsInVwZGF0ZUxsaWJyZSIsInVwZGF0ZSIsIiRvbiIsImUiLCJjdXJyZW50VXNlciIsImxvZ291dCIsImxvZ091dCIsImZhY3RvcnkiLCIkcmVzb3VyY2UiLCJtZXRob2QiLCJsbGlicmVzIiwibG9hZGluZyIsInJlbW92ZUxsaWJyZSIsImluZGV4IiwiaWQiLCJzcGxpY2UiLCJlZGl0YXJMbGlicmUiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIndoZW4iLCJ0ZW1wbGF0ZVVybCIsImF1dG9yaXR6YXQiLCJvdGhlcndpc2UiLCJyZWRpcmVjdFRvIiwicnVuIiwiZXZlbnQiLCJuZXh0IiwiYXV0aCIsInNlcnZpY2UiLCIkaHR0cCIsInNydiIsInRoaXMiLCJnZXQiLCJub0xvZ2luIiwicG9zdCIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsImQiLCJhdXRvciIsIm5vbSIsImNvZ25vbSIsImNvZ25vbTIiLCJhbnkiLCJnZXRGdWxsWWVhciIsImFkZEF1dG9yIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxLQUFBQyxRQUFBQyxPQUFBLE9BQUEsYUFBQSxXQ0FBRCxTQUFBQyxPQUFBLE9BQ0FDLFdBQUEsYUFBQSxTQUFBLFVBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUVBLEdBQUFDLElBQ0FDLFNBQUEsR0FDQUMsU0FBQSxHQUVBTCxHQUFBRyxLQUFBRyxPQUFBQyxPQUFBSixHQUNBSCxFQUFBUSxNQUFBLFdBRUFSLEVBQUFHLE1BQ0EsSUFBQUgsRUFBQUcsS0FBQUMsVUFBQSxJQUFBSixFQUFBRyxLQUFBRSxXQUNBSSxRQUFBQyxJQUFBVixFQUFBRyxNQUNBRixFQUFBTyxNQUFBUixFQUFBRyxLQUFBQyxTQUFBSixFQUFBRyxLQUFBRSxTQUNBLFNBQUFNLEVBQUFDLEdBSUEsS0FBQUEsSUFDQVosRUFBQVcsTUFBQUEsRUFBQUUsWUFFQUMsUUFBQSxXQUNBYixFQUFBYyxVQUFBQyxLQUFBLFNBQUFiLEdBT0FILEVBQUFpQixNQUFBLFFBQUFkLEVBQUFlLE1BQ0FoQixFQUFBaUIsS0FBQSxjQzlCQXRCLFFBQUFDLE9BQUEsT0FDQUMsV0FBQSxpQkFBQSxTQUFBLFVBQUEsWUFBQSxTQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFrQixJQUNBaEIsU0FBQSxHQUNBQyxTQUFBLEdBQ0FnQixVQUFB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QUFBYixFQUFBVyxNQUFBLFNBQUFDLEdBQ0F4QyxFQUFBeUMsT0FBQUQsRUFDQXhDLEVBQUF1RCxTQUFBLE9DTkExRCxRQUFBQyxPQUFBLE9BQ0FxRCxRQUFBLGlCQUFBLFlBQUEsU0FBQUMsR0FDQSxNQUFBQSxHQUFBLGtCQUFBLE1BQ0FQLFFBQ0FRLE9BQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ25nUmVzb3VyY2UnLCduZ1JvdXRlJ10pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUgLCBVc2VyU3ZjICwgJGxvY2F0aW9uKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ0xvZ2luISEhJyk7XG4gICAgdmFyIHVzZXIgPSB7XG4gICAgICB1c2VybmFtZTogXCJcIixcbiAgICAgIHBhc3N3b3JkOiBcIlwiXG4gICAgfVxuICAgICRzY29wZS51c2VyID0gT2JqZWN0LmNyZWF0ZSh1c2VyKTtcbiAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgIC8vZmEgZmFsdGEgY29tcHJvdmFyLWhvID8/P1xuICAgICAgaWYgKCRzY29wZS51c2VyKSB7XG4gICAgICAgIGlmICgkc2NvcGUudXNlci51c2VybmFtZSAhPSBcIlwiICYmICRzY29wZS51c2VyLnBhc3N3b3JkICE9IFwiXCIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUudXNlcik7XG4gICAgICAgICAgVXNlclN2Yy5sb2dpbigkc2NvcGUudXNlci51c2VybmFtZSwgJHNjb3BlLnVzZXIucGFzc3dvcmQsXG4gICAgICAgICAgICBmdW5jdGlvbihlcnJvciwgc3RhdHVzKSB7XG4gICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICBGdW5jacOzIHF1ZSBzJ2V4ZWN1dGFyw6Agc2kgaGkgaGEgdW4gZXJyb3IgZW4gZWwgbG9naW5cbiAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSA0MDEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBlcnJvci5taXNzYXRnZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFVzZXJTdmMuZ2V0VXNlcigpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgU2kgdG90IHZhIGLDqSwgYW5lbSBhIGxhIHDDoGdpbmEgcHJpbmNpcGFsXG4gICAgICAgICAgICAgICAgICBpIGVtZXRlbiB1biBtaXNzYXRnZSBkZSBcImxvZ2luXCIgcGVyIGF2aXNhclxuICAgICAgICAgICAgICAgICAgYSBsYSBub3N0cmEgYXBwIHF1ZSBsJ3VzdWFyaSBoYSBmZXQgbG9naW5cbiAgICAgICAgICAgICAgICAgIGNvcnJlY3RhbWVudC5cbiAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIuZGF0YSk7XG4gICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICB9KVxuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5jb250cm9sbGVyKCdSZWdpc3RyYXJDdHJsJywgZnVuY3Rpb24oJHNjb3BlICwgVXNlclN2YyAsICRsb2NhdGlvbikge1xuICAgIHZhciBkYWRlc1JlZ2lzdHJlID0ge1xuICAgICAgdXNlcm5hbWUgOiBcIlwiLFxuICAgICAgcGFzc3dvcmQgOiBcIlwiLFxuICAgICAgcGFzc3dvcmQyOiBcIlwiXG4gICAgfTtcblxuXG4gICAgJHNjb3BlLmRhZGVzUmVnaXN0cmUgPSBPYmplY3QuY3JlYXRlKGRhZGVzUmVnaXN0cmUpO1xuICAgICRzY29wZS5zb25JZ3VhbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygkc2NvcGUuUmVnaXN0ZXIuJHZhbGlkKTtcbiAgICAgIGlmICgkc2NvcGUuZGFkZXNSZWdpc3RyZS5wYXNzd29yZCA9PT0gJHNjb3BlLmRhZGVzUmVnaXN0cmUucGFzc3dvcmQyKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgJHNjb3BlLlJlZ2lzdGVyLiR2YWxpZCA9IGZhbHNlO1xuICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuUmVnaXN0ZXIuJHZhbGlkKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgICRzY29wZS5yZWdpc3RyYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoISRzY29wZS5kYWRlc1JlZ2lzdHJlLnBhc3N3b3JkIHx8ICEkc2NvcGUuZGFkZXNSZWdpc3RyZS5wYXNzd29yZDIgfHwgISRzY29wZS5kYWRlc1JlZ2lzdHJlLnVzZXJuYW1lKSB7XG4gICAgICAgICRzY29wZS5lcnJvciA9IFwiSGFzIGQnZW1wbGVuYXIgdG90cyBlbHMgY2FtcHNcIjtcbiAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLmRhZGVzUmVnaXN0cmUucGFzc3dvcmQgPT09ICRzY29wZS5kYWRlc1JlZ2lzdHJlLnBhc3N3b3JkMikge1xuICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuZGFkZXNSZWdpc3RyZSk7XG5cbiAgICAgICAgVXNlclN2Yy5yZWdpc3RyZSgkc2NvcGUuZGFkZXNSZWdpc3RyZS51c2VybmFtZSwgJHNjb3BlLmRhZGVzUmVnaXN0cmUucGFzc3dvcmQpXG4gICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycm9yLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gNDA5KVxuICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBlcnJvci5taXNzYXRnZTtcbiAgICAgICAgICAgICAgJHNjb3BlLmRhZGVzUmVnaXN0cmUudXNlcm5hbWUgPSBcIlwiO1xuICAgICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLmVycm9yID0gXCJMZXMgY29udHJhc2VueWVzIG5vIHPDs24gaWd1YWxzXCI7XG4gICAgICB9XG4gICAgfVxuXG4gIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbnRyb2xsZXIoJ2FmZWdpcmxsaWJyZScsIGZ1bmN0aW9uKCRzY29wZSwgTGxpYnJlc0ZhY3RvcnksICRsb2NhdGlvbiwgQXV0b3JzRmFjdG9yeSkge1xuICAgIHZhciBsbGlicmUgPSB7XG4gICAgICB0aXRvbDogXCJcIixcbiAgICAgIGlzYm46IFwiXCIsXG4gICAgICBhdXRvcnM6IFtdLFxuICAgICAgZGF0ZTogbmV3IERhdGUoKVxuICAgIH1cblxuICAgICRzY29wZS5sbGlicmUgPSBPYmplY3QuY3JlYXRlKGxsaWJyZSk7XG5cbiAgICAkc2NvcGUuYWRkTGxpYnJlID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoJHNjb3BlLmxsaWJyZSkge1xuICAgICAgICBpZiAoJHNjb3BlLmxsaWJyZS50aXRvbCAhPSBcIlwiICYmICRzY29wZS5sbGlicmUuaXNibiAhPSBcIlwiKSB7XG5cbiAgICAgICAgICAvLyBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnNlbGVjdGVkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgLy8gICBjb25zb2xlLmxvZygkc2NvcGUuc2VsZWN0ZWRbaV0uX2lkKTtcbiAgICAgICAgICAvLyAgICRzY29wZS5sbGlicmUuYXV0b3JzLnB1c2goJHNjb3BlLnNlbGVjdGVkW2ldLl9pZCk7XG4gICAgICAgICAgLy8gfTtcbiAgICAgICAgICAkc2NvcGUubGxpYnJlLmF1dG9ycyA9ICRzY29wZS5zZWxlY3RlZDtcbiAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUubGxpYnJlKTtcbiAgICAgICAgICBMbGlicmVzRmFjdG9yeS5zYXZlKCRzY29wZS5sbGlicmUsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzJ2hhIGd1YXJkYXRcIik7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygkc2NvcGUubGxpYnJlKTtcbiAgICAgICAgICAgIC8vJHNjb3BlLm5ldGVqYXJDYW1wcygpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yXCIgKyBlcnJvcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUubmV0ZWphckNhbXBzID0gZnVuY3Rpb24oKSB7XG4gICAgICAkc2NvcGUubGxpYnJlID0gbnVsbDtcbiAgICB9XG5cbiAgICBBdXRvcnNGYWN0b3J5LnF1ZXJ5KGZ1bmN0aW9uKGVudHJpZXMpIHtcbiAgICAgICRzY29wZS5BdXRvcnMgPSBlbnRyaWVzO1xuICAgIH0pO1xuICB9KVxuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5jb250cm9sbGVyKCdlZGl0YXJsbGlicmUnLCBmdW5jdGlvbigkc2NvcGUsIExsaWJyZXNGYWN0b3J5LCAkcm9vdFNjb3BlICwgJGxvY2F0aW9uKSB7XG5cbiAgICBpZiAoJHJvb3RTY29wZS5sbGlicmVUb0VkaXQpIHtcbiAgICAgICRzY29wZS5sbGlicmUgPSAkcm9vdFNjb3BlLmxsaWJyZVRvRWRpdDtcbiAgICB9XG4gICAgJHNjb3BlLnVwZGF0ZUxsaWJyZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYoJHNjb3BlLmxsaWJyZSl7XG4gICAgICAgIGlmICgkc2NvcGUubGxpYnJlLnRpdG9sICE9IFwiXCIgJiYgJHNjb3BlLmxsaWJyZS5pc2JuICE9IFwiXCIpIHtcbiAgICAgICAgICBMbGlicmVzRmFjdG9yeS51cGRhdGUoJHNjb3BlLmxsaWJyZSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygndXBkYXRlZCcpXG4gICAgICAgICAgICAvLyRzY29wZS5uZXRlamFyQ2FtcHMoKTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCBcIi9cIiApO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgJHNjb3BlLm5ldGVqYXJDYW1wcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYoJHNjb3BlLmxsaWJyZSl7XG4gICAgICAgICRzY29wZS5sbGlicmUgPSBudWxsO1xuICAgICAgICAkcm9vdFNjb3BlLmxsaWJyZVRvRWRpdCA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuICB9KVxuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5jb250cm9sbGVyKCdMbGlicmVDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sIFVzZXJTdmMpIHtcbiAgICAkc2NvcGUuJG9uKCdsb2dpbicsIGZ1bmN0aW9uKGUsIHVzZXIpIHtcbiAgICAgIC8qXG4gICAgICAgICAgUXVhbiBzJ2hhIGZldCBsb2dpbiBzJ2VtZXQgbCdldmVudCBcImxvZ2luXCJcbiAgICAgICAgICBpIGFpeMOyIGZhIHF1ZSBsYSB2YXJpYWJsZSBkZSBsJ3Njb3BlIFwiY3VycmVudFVzZXJcIlxuICAgICAgICAgIGxpIGRpZW0gcXVpbiB1c3VhcmkgcydoYSBhdXRlbnRpY2FudCwgZCdhcXVlc3RhIG1hbmVyYVxuICAgICAgICAgIGZlbSBxdWUgYXBhcmVndWluIGRpZmVyZW50cyBvcGNpb25zIGFsIG1lbsO6XG4gICAgICAqL1xuICAgICAgJHNjb3BlLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICB9KTtcbiAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAvKlxuICAgICAgICAgIFF1YW4gZmVtIGxvZ291dCBlc2JvcnJlbSBlbCB0b2tlbiBpIGxhIHZhcmlhYmxlXG4gICAgICAgICAgZGUgbCckc2NvcGUgXCJjdXJyZW50VXNlclwiLCBkJ2FxdWVzdGEgZm9ybWEgZGVzYXBhcmVpeGVuXG4gICAgICAgICAgZWxzIG1lbsO6cyBzZW5zaWJsZXMgYSBsYSBhdXRlbnRpY2FjacOzXG4gICAgICAqL1xuICAgICAgVXNlclN2Yy5sb2dPdXQoKTtcbiAgICAgIGRlbGV0ZSAkc2NvcGUuY3VycmVudFVzZXI7XG4gICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgIH07XG4gIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5mYWN0b3J5KCdMbGlicmVzRmFjdG9yeScsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xuICAgIHJldHVybiAkcmVzb3VyY2UoXCIvYXBpL2xsaWJyZXMvOmlkXCIsIG51bGwsIHtcbiAgICAgICd1cGRhdGUnOiB7XG4gICAgICAgIG1ldGhvZDogJ1BVVCdcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbnRyb2xsZXIoJ2xsaXN0YWxsaWJyZScsIGZ1bmN0aW9uKCRzY29wZSwgTGxpYnJlc0ZhY3RvcnksICRyb290U2NvcGUsICRsb2NhdGlvbikge1xuICAgICRzY29wZS5sbGlicmVzID0gW107XG4gICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICRzY29wZS5sbGlicmVzID0gTGxpYnJlc0ZhY3RvcnkucXVlcnkoZnVuY3Rpb24oZW50cmllcykge1xuICAgICAgJHNjb3BlLmxsaWJyZXMgPSBlbnRyaWVzO1xuICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB9KTtcblxuICAgICRzY29wZS5yZW1vdmVMbGlicmUgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgY29uc29sZS5sb2coJHNjb3BlLmN1cnJlbnRVc2VyKTtcbiAgICAgIGlmICgkc2NvcGUuY3VycmVudFVzZXIpIHtcbiAgICAgICAgaWYgKGluZGV4KSB7XG4gICAgICAgICAgTGxpYnJlc0ZhY3RvcnkuZGVsZXRlKHtcbiAgICAgICAgICAgIGlkOiAkc2NvcGUubGxpYnJlc1tpbmRleF0uaXNiblxuICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLmxsaWJyZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgIH1lbHNle1xuICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9sb2dpblwiKTtcblxuICAgICAgfVxuXG4gICAgfVxuICAgICRzY29wZS5lZGl0YXJMbGlicmUgPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgJHJvb3RTY29wZS5sbGlicmVUb0VkaXQgPSAkc2NvcGUubGxpYnJlc1tpbmRleF07XG4gICAgICAkbG9jYXRpb24ucGF0aChcIi9lZGl0YXJsbGlicmVcIik7XG4gICAgfVxuICB9KVxuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5jb25maWcoZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XG4gICAgJHJvdXRlUHJvdmlkZXJcbiAgICAgIC53aGVuKFwiL1wiLCB7XG4gICAgICAgIGNvbnRyb2xsZXI6ICdsbGlzdGFsbGlicmUnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2xsaXN0YS5odG1sJyxcbiAgICAgICAgYXV0b3JpdHphdDogZmFsc2VcbiAgICAgIH0pXG4gICAgICAud2hlbihcIi9ub3VsbGlicmVcIiwge1xuICAgICAgICBjb250cm9sbGVyOiBcImFmZWdpcmxsaWJyZVwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FmZWdpci5odG1sJyxcbiAgICAgICAgYXV0b3JpdHphdDogdHJ1ZVxuICAgICAgfSlcbiAgICAgIC53aGVuKFwiL2VkaXRhcmxsaWJyZVwiLCB7XG4gICAgICAgIGNvbnRyb2xsZXI6IFwiZWRpdGFybGxpYnJlXCIsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnZWRpY2lvLmh0bWwnLFxuICAgICAgICBhdXRvcml0emF0OiB0cnVlXG4gICAgICB9KVxuICAgICAgLndoZW4oXCIvcmVnaXN0cmFyXCIsIHtcbiAgICAgICAgY29udHJvbGxlcjogXCJSZWdpc3RyYXJDdHJsXCIsXG4gICAgICAgIHRlbXBsYXRlVXJsOiBcInJlZ2lzdHJhci5odG1sXCIsXG4gICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICB9KVxuICAgICAgLndoZW4oXCIvbG9naW5cIiwge1xuICAgICAgICBjb250cm9sbGVyOiBcIkxvZ2luQ3RybFwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogXCJsb2dpbi5odG1sXCIsXG4gICAgICAgIGF1dG9yaXR6YXQ6IGZhbHNlXG4gICAgICB9KVxuICAgICAgLndoZW4oXCIvYXV0b3JzXCIsIHtcbiAgICAgICAgY29udHJvbGxlcjogXCJsbGlzdGFBdXRvcnNcIixcbiAgICAgICAgdGVtcGxhdGVVcmw6IFwiYXV0b3IvbGxpc3RhLmh0bWxcIixcbiAgICAgICAgYXV0b3JpdHphdDogZmFsc2VcbiAgICAgIH0pXG4gICAgICAud2hlbihcIi9Ob3VBdXRvclwiLCB7XG4gICAgICAgIGNvbnRyb2xsZXI6IFwiYWZlZ2lyQXV0b3JcIixcbiAgICAgICAgdGVtcGxhdGVVcmw6IFwiYXV0b3IvYWZlZ2lyLmh0bWxcIixcbiAgICAgICAgYXV0b3JpdHphdDogZmFsc2VcbiAgICAgIH0pXG4gICAgICAub3RoZXJ3aXNlKHtcbiAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICB9KTtcblxuICAgIC8vICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh7XG4gICAgLy8gICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgIC8vICAgICAgICAgICAgICAgcmVxdWlyZUJhc2U6IGZhbHNlXG4gICAgLy8gICAgICAgICAgICAgfSk7XG4gIH0pXG4gIC5ydW4oZnVuY3Rpb24oJHJvb3RTY29wZSwgVXNlclN2YywgJGxvY2F0aW9uKSB7XG4gICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oZXZlbnQsIG5leHQpIHtcbiAgICAgIGlmIChuZXh0KVxuICAgICAgICBpZiAoIVVzZXJTdmMuYXV0aCAmIG5leHQuYXV0b3JpdHphdClcbiAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9sb2dpblwiKTtcbiAgICAgICAgLy8gZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIH0pO1xuICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAvLyAuZmFjdG9yeSgnVXNlckZhY3RvcnknLCBmdW5jdGlvbigkcmVzb3VyY2UpIHtcbiAgLy8gICByZXR1cm4gJHJlc291cmNlKFwiL2FwaS91c2Vycy86aWRcIiwgbnVsbCwge1xuICAvLyAgICAgJ3VwZGF0ZSc6IHtcbiAgLy8gICAgICAgbWV0aG9kOiAnUFVUJ1xuICAvLyAgICAgfVxuICAvLyAgIH0pO1xuICAvLyB9KVxuICAuc2VydmljZSgnVXNlclN2YycsIGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgdmFyIHNydiA9IHRoaXM7XG4gICAgc3J2LmF1dGggPSBmYWxzZTtcbiAgICBzcnYuZ2V0VXNlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJyk7XG4gICAgfTtcbiAgICBzcnYubG9naW4gPSBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkLCBub0xvZ2luKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3Nlc3Npb25zJywge1xuICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gICAgICAgIH0pLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSxzdGF0dXMpIHtcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgU2kgbCdhdXRlbnRpY2FjacOzIMOpcyBjb3JyZWN0ZSBsaSBkaWVtIGEgbCdhbmd1bGFyIHF1ZSBjYWRhXG4gICAgICAgICAgICAgICAgdmVnYWRhIHF1ZSBlcyBjb211bmlxdWkgYW1iIGVsIHNlcnZpZG9yIGFmZWdlaXhpIGVsIHRva2VuXG4gICAgICAgICAgICAgICAgYWwgaGVhZGVyICd4LWF1dGgnXG4gICAgICAgICAgICAqL1xuICAgICAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID0gZGF0YTtcbiAgICAgICAgICAgIGlmIChkYXRhKSBzcnYuYXV0aCA9IHRydWU7XG4gICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yLHN0YXR1cyl7XG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgIFNpIGwndXN1YXJpIGkgY29udHJhc2VueWEgbm8gw6lzIGNvcnJlY3RlIGV4ZWN1dGEgbGFcbiAgICAgICAgICAgICAgICBmdW5jacOzbiBjYWxsYmFjayBxdWUgbGkgaGVtIHBhc3NhdCBjb20gcGFyw6BtZXRyZVxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG5vTG9naW4oZXJyb3IsIHN0YXR1cyk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgdGhpcy5yZWdpc3RyZSA9IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgLypcbiAgICAgICAgICBQZXIgcmVnaXN0cmFyIHVuIHVzdWFyaSBub3UsIG5vbcOpcyBoZW0gZGUgZmVyIHVuIHBvc3RcbiAgICAgICAgICBhIGwnYXBpIGQndXN1YXJpc1xuICAgICAgKi9cbiAgICAgIHJldHVybiAkaHR0cC5wb3N0KCcvYXBpL3VzZXJzJywge1xuICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXG4gICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgfSk7XG4gICAgfTtcbiAgICB0aGlzLmxvZ091dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvKlxuICAgICAgICAgICAgUXVhbiBsJ3VzdWFyaSBmYSBsb2dvdXQgcydlc2JvcnJhIGVsIHRva2VuXG4gICAgICAgICAgICBpIHBvc2VtIGxhIHByb3BpZXRhdCBkZWwgc2VydmVpIFwiYXV0aFwiIGEgZmFsc2VcbiAgICAgICAgKi9cbiAgICAgICAgc3J2LmF1dGggPSBmYWxzZTtcbiAgICAgICAgJGh0dHAuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtYXV0aCddID1cIlwiO1xuICAgIH07XG4gIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5jb250cm9sbGVyKCdhZmVnaXJBdXRvcicsIGZ1bmN0aW9uKCRzY29wZSwgQXV0b3JzRmFjdG9yeSwgJGxvY2F0aW9uKSB7XG4gICAgdmFyIGQgPSBuZXcgRGF0ZSgpO1xuICAgIHZhciBhdXRvciA9IHtcbiAgICAgIG5vbTogXCJcIixcbiAgICAgIGNvZ25vbTogXCJcIixcbiAgICAgIGNvZ25vbTI6IFtdLFxuICAgICAgYW55OiBkLmdldEZ1bGxZZWFyKClcbiAgICB9XG4gICAgJHNjb3BlLmF1dG9yID0gT2JqZWN0LmNyZWF0ZShhdXRvcik7XG5cbiAgICAkc2NvcGUuYWRkQXV0b3IgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICgkc2NvcGUuYXV0b3IpIHtcbiAgICAgICAgaWYgKCRzY29wZS5hdXRvci5ub20gIT0gXCJcIiAmJiAkc2NvcGUuYXV0b3IuY29nbm9tICE9IFwiXCIpIHtcbiAgICAgICAgICBBdXRvcnNGYWN0b3J5LnNhdmUoJHNjb3BlLmF1dG9yLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicydoYSBndWFyZGF0XCIpO1xuICAgICAgICAgICAgLy8kc2NvcGUubmV0ZWphckNhbXBzKCk7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCggXCIvYXV0b3JzXCIgKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvclwiICsgZXJyb3IpO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUubmV0ZWphckNhbXBzID0gZnVuY3Rpb24oKSB7XG4gICAgICAkc2NvcGUuYXV0b3IgPSBudWxsO1xuICAgIH1cbiAgfSlcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAuY29udHJvbGxlcignbGxpc3RhQXV0b3JzJywgZnVuY3Rpb24oJHNjb3BlLCBBdXRvcnNGYWN0b3J5LCAkcm9vdFNjb3BlLCAkbG9jYXRpb24pIHtcbiAgICAkc2NvcGUuQXV0b3JzID0gW107XG4gICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xuICAgICRzY29wZS5BdXRvcnMgPSBBdXRvcnNGYWN0b3J5LnF1ZXJ5KGZ1bmN0aW9uKGVudHJpZXMpIHtcbiAgICAgICRzY29wZS5BdXRvcnMgPSBlbnRyaWVzO1xuICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICB9KTtcblxuICAgIC8vICRzY29wZS5yZW1vdmVMbGlicmUgPSBmdW5jdGlvbihpbmRleCkge1xuICAgIC8vICAgY29uc29sZS5sb2coJHNjb3BlLmN1cnJlbnRVc2VyKTtcbiAgICAvLyAgIGlmICgkc2NvcGUuY3VycmVudFVzZXIpIHtcbiAgICAvLyAgICAgaWYgKGluZGV4KSB7XG4gICAgLy8gICAgICAgTGxpYnJlc0ZhY3RvcnkuZGVsZXRlKHtcbiAgICAvLyAgICAgICAgIGlkOiAkc2NvcGUubGxpYnJlc1tpbmRleF0uaXNiblxuICAgIC8vICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgIC8vICAgICAgICAgJHNjb3BlLmxsaWJyZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAvLyAgICAgICB9KVxuICAgIC8vICAgICB9XG4gICAgLy9cbiAgICAvLyAgIH1lbHNle1xuICAgIC8vICAgICAkbG9jYXRpb24ucGF0aChcIi9sb2dpblwiKTtcbiAgICAvL1xuICAgIC8vICAgfVxuICAgIC8vXG4gICAgLy8gfVxuICAgIC8vICRzY29wZS5lZGl0YXJMbGlicmUgPSBmdW5jdGlvbihpbmRleCkge1xuICAgIC8vICAgJHJvb3RTY29wZS5sbGlicmVUb0VkaXQgPSAkc2NvcGUubGxpYnJlc1tpbmRleF07XG4gICAgLy8gICAkbG9jYXRpb24ucGF0aChcIi9lZGl0YXJsbGlicmVcIik7XG4gICAgLy8gfVxuICB9KVxuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5mYWN0b3J5KCdBdXRvcnNGYWN0b3J5JywgZnVuY3Rpb24oJHJlc291cmNlKSB7XG4gICAgcmV0dXJuICRyZXNvdXJjZShcIi9hcGkvYXV0b3JzLzppZFwiLCBudWxsLCB7XG4gICAgICAndXBkYXRlJzoge1xuICAgICAgICBtZXRob2Q6ICdQVVQnXG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9