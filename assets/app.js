var app=angular.module("app",["ngResource","ngRoute"]);angular.module("app").controller("LoginCtrl",["$scope","UserSvc","$location",function(e,r,o){var t={username:"",password:""};e.user=Object.create(t),e.login=function(){e.user&&""!=e.user.username&&""!=e.user.password&&(console.log(e.user),r.login(e.user.username,e.user.password,function(r,o){401==o&&(e.error=r.missatge)}).success(function(){r.getUser().then(function(r){e.$emit("login",r.data),o.path("/")})}))}}]),angular.module("app").controller("RegistrarCtrl",["$scope","UserSvc","$location",function(e,r,o){var t={username:"",password:"",password2:""};e.dadesRegistre=Object.create(t),e.sonIguals=function(){return e.dadesRegistre.password===e.dadesRegistre.password2?!0:(e.Register.$valid=!1,console.log(e.Register.$valid),!1)},e.registrar=function(){e.dadesRegistre.password&&e.dadesRegistre.password2&&e.dadesRegistre.username?e.dadesRegistre.password===e.dadesRegistre.password2?(console.log(e.dadesRegistre),r.registre(e.dadesRegistre.username,e.dadesRegistre.password).success(function(){o.path("/login")}).error(function(r,o){409==o&&(e.error=r.missatge),e.dadesRegistre.username=""})):e.error="Les contrasenyes no s√≥n iguals":e.error="Has d'emplenar tots els camps"}}]),angular.module("app").controller("afegirllibre",["$scope","LlibresFactory","$location","AutorsFactory",function(e,r,o,t){var l={titol:"",isbn:"",autors:[],date:new Date};e.llibre=Object.create(l),e.addLlibre=function(){e.llibre&&""!=e.llibre.titol&&""!=e.llibre.isbn&&(e.llibre.autors=e.selected,console.log(e.llibre),r.save(e.llibre,function(){console.log("s'ha guardat"),o.path("/")},function(e){console.log("Error"+e)}))},e.netejarCamps=function(){e.llibre=null},t.query(function(r){e.Autors=r})}]),angular.module("app").controller("editarllibre",["$scope","LlibresFactory","$rootScope","$location",function(e,r,o,t){o.llibreToEdit&&(e.llibre=o.llibreToEdit),e.updateLlibre=function(){e.llibre&&""!=e.llibre.titol&&""!=e.llibre.isbn&&(e.llibre.autors=e.selected,console.log(e.llibre),r.update(e.llibre,function(){console.log("updated"),t.path("/")}))},e.netejarCamps=function(){e.llibre&&(e.llibre=null,o.llibreToEdit=null)}}]),angular.module("app").controller("LlibreCtrl",["$scope","$location","UserSvc",function(e,r,o){e.$on("login",function(r,o){e.currentUser=o}),e.logout=function(){o.logOut(),delete e.currentUser,r.path("/")}}]),angular.module("app").factory("LlibresFactory",["$resource",function(e){return e("/api/llibres/:id",null,{update:{method:"PUT"}})}]).factory("LlibresSrv",["$rootScope",function(e){var r=io().connect();return r.on("connect",function(){e.$broadcast("connected"),e.$apply()}),{actualitzar:function(o){r.on("updateFucker",function(){console.log("update"),o(),e.$apply()})}}}]),angular.module("app").controller("llistallibre",["$scope","LlibresFactory","$rootScope","$location","LlibresSrv",function(e,r,o,t,l){function a(){r.query(function(r){e.llibres=r,e.loading=!1})}e.llibres=[],e.loading=!0,a(),l.actualitzar(a),e.removeLlibre=function(o){console.log(e.currentUser),e.currentUser?o&&r["delete"]({id:e.llibres[o].isbn},function(){e.llibres.splice(o,1)}):t.path("/login")},e.editarLlibre=function(r){o.llibreToEdit=e.llibres[r],t.path("/editarllibre")}}]),angular.module("app").config(["$routeProvider","$locationProvider",function(e){e.when("/",{controller:"llistallibre",templateUrl:"llista.html",autoritzat:!1}).when("/noullibre",{controller:"afegirllibre",templateUrl:"afegir.html",autoritzat:!0}).when("/editarllibre",{controller:"editarllibre",templateUrl:"edicio.html",autoritzat:!0}).when("/registrar",{controller:"RegistrarCtrl",templateUrl:"registrar.html",autoritzat:!1}).when("/login",{controller:"LoginCtrl",templateUrl:"login.html",autoritzat:!1}).when("/autors",{controller:"llistaAutors",templateUrl:"autor/llista.html",autoritzat:!1}).when("/NouAutor",{controller:"afegirAutor",templateUrl:"autor/afegir.html",autoritzat:!1}).otherwise({redirectTo:"/"})}]).run(["$rootScope","UserSvc","$location",function(e,r,o){e.$on("$routeChangeStart",function(e,t){t&&!r.auth&t.autoritzat&&o.path("/login")})}]),angular.module("app").service("UserSvc",["$http",function(e){var r=this;r.auth=!1,r.getUser=function(){return e.get("/api/users")},r.login=function(o,t,l){return e.post("/api/sessions",{username:o,password:t}).success(function(o){e.defaults.headers.common["x-auth"]=o,o&&(r.auth=!0)}).error(function(e,r){l(e,r)})},this.registre=function(r,o){return e.post("/api/users",{username:r,password:o})},this.logOut=function(){r.auth=!1,e.defaults.headers.common["x-auth"]=""}}]),angular.module("app").controller("afegirAutor",["$scope","AutorsFactory","$location",function(e,r,o){var t=new Date,l={nom:"",cognom:"",cognom2:[],any:t.getFullYear()};e.autor=Object.create(l),e.addAutor=function(){e.autor&&""!=e.autor.nom&&""!=e.autor.cognom&&r.save(e.autor,function(){console.log("s'ha guardat"),o.path("/autors")},function(e){console.log("Error"+e)})},e.netejarCamps=function(){e.autor=null}}]),angular.module("app").controller("llistaAutors",["$scope","AutorsFactory","$rootScope","$location",function(e,r){e.Autors=[],e.loading=!0,e.Autors=r.query(function(r){e.Autors=r,e.loading=!1})}]),angular.module("app").factory("AutorsFactory",["$resource",function(e){return e("/api/autors/:id",null,{update:{method:"PUT"}})}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsIkxvZ2luQ3RybC5qcyIsIlJlZ2lzdHJhckN0cmwuanMiLCJhZmVnaXJsbGlicmUuY3RybC5qcyIsImVkaXRhcmxsaWJyZS5jdHJsLmpzIiwibGxpYnJlcy5jdHJsLmpzIiwibGxpYnJlcy5mYWN0b3J5cy5qcyIsImxsaXN0YS5jdHJsLmpzIiwicm91dGVzLmpzIiwidXNlcnMuZmFjdG9yeXMuanMiLCJhdXRvcnMvYWZlZ2lyLWF1dG9yLmN0cmwuanMiLCJhdXRvcnMvYXV0b3JzLWxsaXN0YS5jdHJsLmpzIiwiYXV0b3JzL2F1dG9ycy5mYWN0b3J5LmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiVXNlclN2YyIsIiRsb2NhdGlvbiIsInVzZXIiLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwiT2JqZWN0IiwiY3JlYXRlIiwibG9naW4iLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJzdGF0dXMiLCJtaXNzYXRnZSIsInN1Y2Nlc3MiLCJnZXRVc2VyIiwidGhlbiIsIiRlbWl0IiwiZGF0YSIsInBhdGgiLCJkYWRlc1JlZ2lzdHJlIiwicGFzc3dvcmQyIiwic29uSWd1YWxzIiwiUmVnaXN0ZXIiLCIkdmFsaWQiLCJyZWdpc3RyYXIiLCJyZWdpc3RyZSIsIkxsaWJyZXNGYWN0b3J5IiwiQXV0b3JzRmFjdG9yeSIsImxsaWJyZSIsInRpdG9sIiwiaXNibiIsImF1dG9ycyIsImRhdGUiLCJEYXRlIiwiYWRkTGxpYnJlIiwic2VsZWN0ZWQiLCJzYXZlIiwibmV0ZWphckNhbXBzIiwicXVlcnkiLCJlbnRyaWVzIiwiQXV0b3JzIiwiJHJvb3RTY29wZSIsImxsaWJyZVRvRWRpdCIsInVwZGF0ZUxsaWJyZSIsInVwZGF0ZSIsIiRvbiIsImUiLCJjdXJyZW50VXNlciIsImxvZ291dCIsImxvZ091dCIsImZhY3RvcnkiLCIkcmVzb3VyY2UiLCJtZXRob2QiLCJzb2NrZXQiLCJpbyIsImNvbm5lY3QiLCJvbiIsIiRicm9hZGNhc3QiLCIkYXBwbHkiLCJhY3R1YWxpdHphciIsImNhbGxiYWNrIiwiTGxpYnJlc1NydiIsImNhcnJlZ2FyRWxzTGxpYnJlcyIsImxsaWJyZXMiLCJsb2FkaW5nIiwicmVtb3ZlTGxpYnJlIiwiaW5kZXgiLCJpZCIsInNwbGljZSIsImVkaXRhckxsaWJyZSIsImNvbmZpZyIsIiRyb3V0ZVByb3ZpZGVyIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiYXV0b3JpdHphdCIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCJydW4iLCJldmVudCIsIm5leHQiLCJhdXRoIiwic2VydmljZSIsIiRodHRwIiwic3J2IiwidGhpcyIsImdldCIsIm5vTG9naW4iLCJwb3N0IiwiZGVmYXVsdHMiLCJoZWFkZXJzIiwiY29tbW9uIiwiZCIsImF1dG9yIiwibm9tIiwiY29nbm9tIiwiY29nbm9tMiIsImFueSIsImdldEZ1bGxZZWFyIiwiYWRkQXV0b3IiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLEtBQUFDLFFBQUFDLE9BQUEsT0FBQSxhQUFBLFdDQUFELFNBQUFDLE9BQUEsT0FDQUMsV0FBQSxhQUFBLFNBQUEsVUFBQSxZQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBRUEsR0FBQUMsSUFDQUMsU0FBQSxHQUNBQyxTQUFBLEdBRUFMLEdBQUFHLEtBQUFHLE9BQUFDLE9BQUFKLEdBQ0FILEVBQUFRLE1BQUEsV0FFQVIsRUFBQUcsTUFDQSxJQUFBSCxFQUFBRyxLQUFBQyxVQUFBLElBQUFKLEVBQUFHLEtBQUFFLFdBQ0FJLFFBQUFDLElBQUFWLEVBQUFHLE1BQ0FGLEVBQUFPLE1BQUFSLEVBQUFHLEtBQUFDLFNBQUFKLEVBQUFHLEtBQUFFLFNBQ0EsU0FBQU0sRUFBQUMsR0FJQSxLQUFBQSxJQUNBWixFQUFBVyxNQUFBQSxFQUFBRSxZQUVBQyxRQUFBLFdBQ0FiLEVBQUFjLFVBQUFDLEtBQUEsU0FBQWIsR0FPQUgsRUFBQWlCLE1BQUEsUUFBQWQsRUFBQWUsTUFDQWhCLEVBQUFpQixLQUFBLGNDOUJB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QUMsV0FDQUMsSUFBQUwsRUFBQU0sY0FFQWxHLEdBQUE2RixNQUFBdkYsT0FBQUMsT0FBQXNGLEdBRUE3RixFQUFBbUcsU0FBQSxXQUNBbkcsRUFBQTZGLE9BQ0EsSUFBQTdGLEVBQUE2RixNQUFBQyxLQUFBLElBQUE5RixFQUFBNkYsTUFBQUUsUUFDQW5FLEVBQUFTLEtBQUFyQyxFQUFBNkYsTUFBQSxXQUNBcEYsUUFBQUMsSUFBQSxnQkFFQVIsRUFBQWlCLEtBQUEsWUFDQSxTQUFBUixHQUNBRixRQUFBQyxJQUFBLFFBQUFDLE1BTUFYLEVBQUFzQyxhQUFBLFdBQ0F0QyxFQUFBNkYsTUFBQSxTQzFCQWhHLFFBQUFDLE9BQUEsT0FDQUMsV0FBQSxnQkFBQSxTQUFBLGdCQUFBLGFBQUEsWUFBQSxTQUFBQyxFQUFBNEIsR0FDQTVCLEVBQUF5QyxVQUNBekMsRUFBQWlFLFNBQUEsRUFDQWpFLEVBQUF5QyxPQUFBYixFQUFBVyxNQUFBLFNBQUFDLEdBQ0F4QyxFQUFBeUMsT0FBQUQsRUFDQXhDLEVBQUFpRSxTQUFBLE9DTkFwRSxRQUFBQyxPQUFBLE9BQ0FxRCxRQUFBLGlCQUFBLFlBQUEsU0FBQUMsR0FDQSxNQUFBQSxHQUFBLGtCQUFBLE1BQ0FQLFFBQ0FRLE9BQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ25nUmVzb3VyY2UnLCduZ1JvdXRlJ10pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5jb250cm9sbGVyKCdMb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUgLCBVc2VyU3ZjICwgJGxvY2F0aW9uKSB7XG4gICAgLy8gY29uc29sZS5sb2coJ0xvZ2luISEhJyk7XG4gICAgdmFyIHVzZXIgPSB7XG4gICAgICB1c2VybmFtZTogXCJcIixcbiAgICAgIHBhc3N3b3JkOiBcIlwiXG4gICAgfVxuICAgICRzY29wZS51c2VyID0gT2JqZWN0LmNyZWF0ZSh1c2VyKTtcbiAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcbiAgICAgIC8vZmEgZmFsdGEgY29tcHJvdmFyLWhvID8/P1xuICAgICAgaWYgKCRzY29wZS51c2VyKSB7XG4gICAgICAgIGlmICgkc2NvcGUudXNlci51c2VybmFtZSAhPSBcIlwiICYmICRzY29wZS51c2VyLnBhc3N3b3JkICE9IFwiXCIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUudXNlcik7XG4gICAgICAgICAgVXNlclN2Yy5sb2dpbigkc2NvcGUudXNlci51c2VybmFtZSwgJHNjb3BlLnVzZXIucGFzc3dvcmQsXG4gICAgICAgICAgICBmdW5jdGlvbihlcnJvciwgc3RhdHVzKSB7XG4gICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICBGdW5jacOzIHF1ZSBzJ2V4ZWN1dGFyw6Agc2kgaGkgaGEgdW4gZXJyb3IgZW4gZWwgbG9naW5cbiAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSA0MDEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBlcnJvci5taXNzYXRnZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFVzZXJTdmMuZ2V0VXNlcigpLnRoZW4oZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgU2kgdG90IHZhIGLDqSwgYW5lbSBhIGxhIHDDoGdpbmEgcHJpbmNpcGFsXG4gICAgICAgICAgICAgICAgICBpIGVtZXRlbiB1biBtaXNzYXRnZSBkZSBcImxvZ2luXCIgcGVyIGF2aXNhclxuICAgICAgICAgICAgICAgICAgYSBsYSBub3N0cmEgYXBwIHF1ZSBsJ3VzdWFyaSBoYSBmZXQgbG9naW5cbiAgICAgICAgICAgICAgICAgIGNvcnJlY3RhbWVudC5cbiAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgJHNjb3BlLiRlbWl0KCdsb2dpbicsIHVzZXIuZGF0YSk7XG4gICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICB9KVxuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5jb250cm9sbGVyKCdSZWdpc3RyYXJDdHJsJywgZnVuY3Rpb24oJHNjb3BlICwgVXNlclN2YyAsICRsb2NhdGlvbikge1xuICAgIHZhciBkYWRlc1JlZ2lzdHJlID0ge1xuICAgICAgdXNlcm5hbWUgOiBcIlwiLFxuICAgICAgcGFzc3dvcmQgOiBcIlwiLFxuICAgICAgcGFzc3dvcmQyOiBcIlwiXG4gICAgfTtcblxuXG4gICAgJHNjb3BlLmRhZGVzUmVnaXN0cmUgPSBPYmplY3QuY3JlYXRlKGRhZGVzUmVnaXN0cmUpO1xuICAgICRzY29wZS5zb25JZ3VhbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygkc2NvcGUuUmVnaXN0ZXIuJHZhbGlkKTtcbiAgICAgIGlmICgkc2NvcGUuZGFkZXNSZWdpc3RyZS5wYXNzd29yZCA9PT0gJHNjb3BlLmRhZGVzUmVnaXN0cmUucGFzc3dvcmQyKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgJHNjb3BlLlJlZ2lzdGVyLiR2YWxpZCA9IGZhbHNlO1xuICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuUmVnaXN0ZXIuJHZhbGlkKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgICRzY29wZS5yZWdpc3RyYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoISRzY29wZS5kYWRlc1JlZ2lzdHJlLnBhc3N3b3JkIHx8ICEkc2NvcGUuZGFkZXNSZWdpc3RyZS5wYXNzd29yZDIgfHwgISRzY29wZS5kYWRlc1JlZ2lzdHJlLnVzZXJuYW1lKSB7XG4gICAgICAgICRzY29wZS5lcnJvciA9IFwiSGFzIGQnZW1wbGVuYXIgdG90cyBlbHMgY2FtcHNcIjtcbiAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLmRhZGVzUmVnaXN0cmUucGFzc3dvcmQgPT09ICRzY29wZS5kYWRlc1JlZ2lzdHJlLnBhc3N3b3JkMikge1xuICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUuZGFkZXNSZWdpc3RyZSk7XG5cbiAgICAgICAgVXNlclN2Yy5yZWdpc3RyZSgkc2NvcGUuZGFkZXNSZWdpc3RyZS51c2VybmFtZSwgJHNjb3BlLmRhZGVzUmVnaXN0cmUucGFzc3dvcmQpXG4gICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGVycm9yLCBzdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gNDA5KVxuICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSBlcnJvci5taXNzYXRnZTtcbiAgICAgICAgICAgICAgJHNjb3BlLmRhZGVzUmVnaXN0cmUudXNlcm5hbWUgPSBcIlwiO1xuICAgICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHNjb3BlLmVycm9yID0gXCJMZXMgY29udHJhc2VueWVzIG5vIHPDs24gaWd1YWxzXCI7XG4gICAgICB9XG4gICAgfVxuXG4gIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbnRyb2xsZXIoJ2FmZWdpcmxsaWJyZScsIGZ1bmN0aW9uKCRzY29wZSwgTGxpYnJlc0ZhY3RvcnksICRsb2NhdGlvbiwgQXV0b3JzRmFjdG9yeSkge1xuICAgIHZhciBsbGlicmUgPSB7XG4gICAgICB0aXRvbDogXCJcIixcbiAgICAgIGlzYm46IFwiXCIsXG4gICAgICBhdXRvcnM6IFtdLFxuICAgICAgZGF0ZTogbmV3IERhdGUoKVxuICAgIH1cblxuICAgICRzY29wZS5sbGlicmUgPSBPYmplY3QuY3JlYXRlKGxsaWJyZSk7XG5cbiAgICAkc2NvcGUuYWRkTGxpYnJlID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoJHNjb3BlLmxsaWJyZSkge1xuICAgICAgICBpZiAoJHNjb3BlLmxsaWJyZS50aXRvbCAhPSBcIlwiICYmICRzY29wZS5sbGlicmUuaXNibiAhPSBcIlwiKSB7XG5cbiAgICAgICAgICAvLyBmb3IodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnNlbGVjdGVkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgLy8gICBjb25zb2xlLmxvZygkc2NvcGUuc2VsZWN0ZWRbaV0uX2lkKTtcbiAgICAgICAgICAvLyAgICRzY29wZS5sbGlicmUuYXV0b3JzLnB1c2goJHNjb3BlLnNlbGVjdGVkW2ldLl9pZCk7XG4gICAgICAgICAgLy8gfTtcbiAgICAgICAgICAkc2NvcGUubGxpYnJlLmF1dG9ycyA9ICRzY29wZS5zZWxlY3RlZDtcbiAgICAgICAgICBjb25zb2xlLmxvZygkc2NvcGUubGxpYnJlKTtcbiAgICAgICAgICBMbGlicmVzRmFjdG9yeS5zYXZlKCRzY29wZS5sbGlicmUsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJzJ2hhIGd1YXJkYXRcIik7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZygkc2NvcGUubGxpYnJlKTtcbiAgICAgICAgICAgIC8vJHNjb3BlLm5ldGVqYXJDYW1wcygpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yXCIgKyBlcnJvcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUubmV0ZWphckNhbXBzID0gZnVuY3Rpb24oKSB7XG4gICAgICAkc2NvcGUubGxpYnJlID0gbnVsbDtcbiAgICB9XG5cbiAgICBBdXRvcnNGYWN0b3J5LnF1ZXJ5KGZ1bmN0aW9uKGVudHJpZXMpIHtcbiAgICAgICRzY29wZS5BdXRvcnMgPSBlbnRyaWVzO1xuICAgIH0pO1xuICB9KVxuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5jb250cm9sbGVyKCdlZGl0YXJsbGlicmUnLCBmdW5jdGlvbigkc2NvcGUsIExsaWJyZXNGYWN0b3J5LCAkcm9vdFNjb3BlICwgJGxvY2F0aW9uKSB7XG5cbiAgICBpZiAoJHJvb3RTY29wZS5sbGlicmVUb0VkaXQpIHtcbiAgICAgICRzY29wZS5sbGlicmUgPSAkcm9vdFNjb3BlLmxsaWJyZVRvRWRpdDtcbiAgICB9XG4gICAgJHNjb3BlLnVwZGF0ZUxsaWJyZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYoJHNjb3BlLmxsaWJyZSl7XG5cbiAgICAgICAgaWYgKCRzY29wZS5sbGlicmUudGl0b2wgIT0gXCJcIiAmJiAkc2NvcGUubGxpYnJlLmlzYm4gIT0gXCJcIikge1xuICAgICAgICAgICRzY29wZS5sbGlicmUuYXV0b3JzID0gJHNjb3BlLnNlbGVjdGVkO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5sbGlicmUpO1xuICAgICAgICAgIExsaWJyZXNGYWN0b3J5LnVwZGF0ZSgkc2NvcGUubGxpYnJlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGVkJylcbiAgICAgICAgICAgIC8vJHNjb3BlLm5ldGVqYXJDYW1wcygpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoIFwiL1wiICk7XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICAkc2NvcGUubmV0ZWphckNhbXBzID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZigkc2NvcGUubGxpYnJlKXtcbiAgICAgICAgJHNjb3BlLmxsaWJyZSA9IG51bGw7XG4gICAgICAgICRyb290U2NvcGUubGxpYnJlVG9FZGl0ID0gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbnRyb2xsZXIoJ0xsaWJyZUN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgVXNlclN2Yykge1xuICAgICRzY29wZS4kb24oJ2xvZ2luJywgZnVuY3Rpb24oZSwgdXNlcikge1xuICAgICAgLypcbiAgICAgICAgICBRdWFuIHMnaGEgZmV0IGxvZ2luIHMnZW1ldCBsJ2V2ZW50IFwibG9naW5cIlxuICAgICAgICAgIGkgYWl4w7IgZmEgcXVlIGxhIHZhcmlhYmxlIGRlIGwnc2NvcGUgXCJjdXJyZW50VXNlclwiXG4gICAgICAgICAgbGkgZGllbSBxdWluIHVzdWFyaSBzJ2hhIGF1dGVudGljYW50LCBkJ2FxdWVzdGEgbWFuZXJhXG4gICAgICAgICAgZmVtIHF1ZSBhcGFyZWd1aW4gZGlmZXJlbnRzIG9wY2lvbnMgYWwgbWVuw7pcbiAgICAgICovXG4gICAgICAkc2NvcGUuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgIH0pO1xuICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgIC8qXG4gICAgICAgICAgUXVhbiBmZW0gbG9nb3V0IGVzYm9ycmVtIGVsIHRva2VuIGkgbGEgdmFyaWFibGVcbiAgICAgICAgICBkZSBsJyRzY29wZSBcImN1cnJlbnRVc2VyXCIsIGQnYXF1ZXN0YSBmb3JtYSBkZXNhcGFyZWl4ZW5cbiAgICAgICAgICBlbHMgbWVuw7pzIHNlbnNpYmxlcyBhIGxhIGF1dGVudGljYWNpw7NcbiAgICAgICovXG4gICAgICBVc2VyU3ZjLmxvZ091dCgpO1xuICAgICAgZGVsZXRlICRzY29wZS5jdXJyZW50VXNlcjtcbiAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgfTtcbiAgfSk7XG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmZhY3RvcnkoJ0xsaWJyZXNGYWN0b3J5JywgZnVuY3Rpb24oJHJlc291cmNlKSB7XG4gICAgcmV0dXJuICRyZXNvdXJjZShcIi9hcGkvbGxpYnJlcy86aWRcIiwgbnVsbCwge1xuICAgICAgJ3VwZGF0ZSc6IHtcbiAgICAgICAgbWV0aG9kOiAnUFVUJ1xuICAgICAgfVxuICAgIH0pO1xuICB9KVxuICAuZmFjdG9yeSgnTGxpYnJlc1NydicsIGZ1bmN0aW9uKCRyb290U2NvcGUpIHtcbiAgICB2YXIgc29ja2V0ID0gaW8oKS5jb25uZWN0KCk7XG4gICAgc29ja2V0Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24ocykge1xuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjb25uZWN0ZWQnKTtcbiAgICAgICRyb290U2NvcGUuJGFwcGx5KCk7IC8vVGhpcyB0ZWxscyBBbmd1bGFySlMgdGhhdCBpdCBuZWVkcyB0byBjaGVjayB0aGUgc3RhdGUgb2YgdGhlIGFwcGxpY2F0aW9uIGFuZCB1cGRhdGUgdGhlIHRlbXBsYXRlc1xuICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICBhY3R1YWxpdHphcjogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgc29ja2V0Lm9uKCd1cGRhdGVGdWNrZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygndXBkYXRlJyk7XG4gICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC5jb250cm9sbGVyKCdsbGlzdGFsbGlicmUnLCBmdW5jdGlvbigkc2NvcGUsIExsaWJyZXNGYWN0b3J5LCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sIExsaWJyZXNTcnYpIHtcbiAgICAkc2NvcGUubGxpYnJlcyA9IFtdO1xuICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcblxuICAgIGZ1bmN0aW9uIGNhcnJlZ2FyRWxzTGxpYnJlcygpe1xuICAgICAgTGxpYnJlc0ZhY3RvcnkucXVlcnkoZnVuY3Rpb24oZW50cmllcykge1xuICAgICAgICAkc2NvcGUubGxpYnJlcyA9IGVudHJpZXM7XG4gICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9XG4gICAgY2FycmVnYXJFbHNMbGlicmVzKCk7XG4gICAgTGxpYnJlc1Nydi5hY3R1YWxpdHphcihjYXJyZWdhckVsc0xsaWJyZXMpO1xuXG4gICAgJHNjb3BlLnJlbW92ZUxsaWJyZSA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICBjb25zb2xlLmxvZygkc2NvcGUuY3VycmVudFVzZXIpO1xuICAgICAgaWYgKCRzY29wZS5jdXJyZW50VXNlcikge1xuICAgICAgICBpZiAoaW5kZXgpIHtcbiAgICAgICAgICBMbGlicmVzRmFjdG9yeS5kZWxldGUoe1xuICAgICAgICAgICAgaWQ6ICRzY29wZS5sbGlicmVzW2luZGV4XS5pc2JuXG4gICAgICAgICAgfSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2NvcGUubGxpYnJlcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgfWVsc2V7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL2xvZ2luXCIpO1xuXG4gICAgICB9XG5cbiAgICB9XG4gICAgJHNjb3BlLmVkaXRhckxsaWJyZSA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAkcm9vdFNjb3BlLmxsaWJyZVRvRWRpdCA9ICRzY29wZS5sbGlicmVzW2luZGV4XTtcbiAgICAgICRsb2NhdGlvbi5wYXRoKFwiL2VkaXRhcmxsaWJyZVwiKTtcbiAgICB9XG4gIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbmZpZyhmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcbiAgICAkcm91dGVQcm92aWRlclxuICAgICAgLndoZW4oXCIvXCIsIHtcbiAgICAgICAgY29udHJvbGxlcjogJ2xsaXN0YWxsaWJyZScsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnbGxpc3RhLmh0bWwnLFxuICAgICAgICBhdXRvcml0emF0OiBmYWxzZVxuICAgICAgfSlcbiAgICAgIC53aGVuKFwiL25vdWxsaWJyZVwiLCB7XG4gICAgICAgIGNvbnRyb2xsZXI6IFwiYWZlZ2lybGxpYnJlXCIsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYWZlZ2lyLmh0bWwnLFxuICAgICAgICBhdXRvcml0emF0OiB0cnVlXG4gICAgICB9KVxuICAgICAgLndoZW4oXCIvZWRpdGFybGxpYnJlXCIsIHtcbiAgICAgICAgY29udHJvbGxlcjogXCJlZGl0YXJsbGlicmVcIixcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdlZGljaW8uaHRtbCcsXG4gICAgICAgIGF1dG9yaXR6YXQ6IHRydWVcbiAgICAgIH0pXG4gICAgICAud2hlbihcIi9yZWdpc3RyYXJcIiwge1xuICAgICAgICBjb250cm9sbGVyOiBcIlJlZ2lzdHJhckN0cmxcIixcbiAgICAgICAgdGVtcGxhdGVVcmw6IFwicmVnaXN0cmFyLmh0bWxcIixcbiAgICAgICAgYXV0b3JpdHphdDogZmFsc2VcbiAgICAgIH0pXG4gICAgICAud2hlbihcIi9sb2dpblwiLCB7XG4gICAgICAgIGNvbnRyb2xsZXI6IFwiTG9naW5DdHJsXCIsXG4gICAgICAgIHRlbXBsYXRlVXJsOiBcImxvZ2luLmh0bWxcIixcbiAgICAgICAgYXV0b3JpdHphdDogZmFsc2VcbiAgICAgIH0pXG4gICAgICAud2hlbihcIi9hdXRvcnNcIiwge1xuICAgICAgICBjb250cm9sbGVyOiBcImxsaXN0YUF1dG9yc1wiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogXCJhdXRvci9sbGlzdGEuaHRtbFwiLFxuICAgICAgICBhdXRvcml0emF0OiBmYWxzZVxuICAgICAgfSlcbiAgICAgIC53aGVuKFwiL05vdUF1dG9yXCIsIHtcbiAgICAgICAgY29udHJvbGxlcjogXCJhZmVnaXJBdXRvclwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogXCJhdXRvci9hZmVnaXIuaHRtbFwiLFxuICAgICAgICBhdXRvcml0emF0OiBmYWxzZVxuICAgICAgfSlcbiAgICAgIC5vdGhlcndpc2Uoe1xuICAgICAgICByZWRpcmVjdFRvOiAnLydcbiAgICAgIH0pO1xuXG4gICAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHtcbiAgICAvLyAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgLy8gICAgICAgICAgICAgICByZXF1aXJlQmFzZTogZmFsc2VcbiAgICAvLyAgICAgICAgICAgICB9KTtcbiAgfSlcbiAgLnJ1bihmdW5jdGlvbigkcm9vdFNjb3BlLCBVc2VyU3ZjLCAkbG9jYXRpb24pIHtcbiAgICAkcm9vdFNjb3BlLiRvbignJHJvdXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihldmVudCwgbmV4dCkge1xuICAgICAgaWYgKG5leHQpXG4gICAgICAgIGlmICghVXNlclN2Yy5hdXRoICYgbmV4dC5hdXRvcml0emF0KVxuICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL2xvZ2luXCIpO1xuICAgICAgICAvLyBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgfSk7XG4gIH0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gIC8vIC5mYWN0b3J5KCdVc2VyRmFjdG9yeScsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xuICAvLyAgIHJldHVybiAkcmVzb3VyY2UoXCIvYXBpL3VzZXJzLzppZFwiLCBudWxsLCB7XG4gIC8vICAgICAndXBkYXRlJzoge1xuICAvLyAgICAgICBtZXRob2Q6ICdQVVQnXG4gIC8vICAgICB9XG4gIC8vICAgfSk7XG4gIC8vIH0pXG4gIC5zZXJ2aWNlKCdVc2VyU3ZjJywgZnVuY3Rpb24oJGh0dHApIHtcbiAgICB2YXIgc3J2ID0gdGhpcztcbiAgICBcbiAgICBzcnYuYXV0aCA9IGZhbHNlO1xuICAgIHNydi5nZXRVc2VyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMnKTtcbiAgICB9O1xuXG4gICAgc3J2LmxvZ2luID0gZnVuY3Rpb24gKHVzZXJuYW1lLCBwYXNzd29yZCwgbm9Mb2dpbikge1xuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9zZXNzaW9ucycsIHtcbiAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZSxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsc3RhdHVzKSB7XG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgIFNpIGwnYXV0ZW50aWNhY2nDsyDDqXMgY29ycmVjdGUgbGkgZGllbSBhIGwnYW5ndWxhciBxdWUgY2FkYVxuICAgICAgICAgICAgICAgIHZlZ2FkYSBxdWUgZXMgY29tdW5pcXVpIGFtYiBlbCBzZXJ2aWRvciBhZmVnZWl4aSBlbCB0b2tlblxuICAgICAgICAgICAgICAgIGFsIGhlYWRlciAneC1hdXRoJ1xuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWyd4LWF1dGgnXSA9IGRhdGE7XG4gICAgICAgICAgICBpZiAoZGF0YSkgc3J2LmF1dGggPSB0cnVlO1xuICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcixzdGF0dXMpe1xuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICAgICBTaSBsJ3VzdWFyaSBpIGNvbnRyYXNlbnlhIG5vIMOpcyBjb3JyZWN0ZSBleGVjdXRhIGxhXG4gICAgICAgICAgICAgICAgZnVuY2nDs24gY2FsbGJhY2sgcXVlIGxpIGhlbSBwYXNzYXQgY29tIHBhcsOgbWV0cmVcbiAgICAgICAgICAgICovXG4gICAgICAgICAgICBub0xvZ2luKGVycm9yLCBzdGF0dXMpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHRoaXMucmVnaXN0cmUgPSBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgIC8qXG4gICAgICAgICAgUGVyIHJlZ2lzdHJhciB1biB1c3Vhcmkgbm91LCBub23DqXMgaGVtIGRlIGZlciB1biBwb3N0XG4gICAgICAgICAgYSBsJ2FwaSBkJ3VzdWFyaXNcbiAgICAgICovXG4gICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS91c2VycycsIHtcbiAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLFxuICAgICAgICBwYXNzd29yZDogcGFzc3dvcmRcbiAgICAgIH0pO1xuICAgIH07XG4gICAgdGhpcy5sb2dPdXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLypcbiAgICAgICAgICAgIFF1YW4gbCd1c3VhcmkgZmEgbG9nb3V0IHMnZXNib3JyYSBlbCB0b2tlblxuICAgICAgICAgICAgaSBwb3NlbSBsYSBwcm9waWV0YXQgZGVsIHNlcnZlaSBcImF1dGhcIiBhIGZhbHNlXG4gICAgICAgICovXG4gICAgICAgIHNydi5hdXRoID0gZmFsc2U7XG4gICAgICAgICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWyd4LWF1dGgnXSA9XCJcIjtcbiAgICB9O1xuICB9KTtcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAuY29udHJvbGxlcignYWZlZ2lyQXV0b3InLCBmdW5jdGlvbigkc2NvcGUsIEF1dG9yc0ZhY3RvcnksICRsb2NhdGlvbikge1xuICAgIHZhciBkID0gbmV3IERhdGUoKTtcbiAgICB2YXIgYXV0b3IgPSB7XG4gICAgICBub206IFwiXCIsXG4gICAgICBjb2dub206IFwiXCIsXG4gICAgICBjb2dub20yOiBbXSxcbiAgICAgIGFueTogZC5nZXRGdWxsWWVhcigpXG4gICAgfVxuICAgICRzY29wZS5hdXRvciA9IE9iamVjdC5jcmVhdGUoYXV0b3IpO1xuXG4gICAgJHNjb3BlLmFkZEF1dG9yID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoJHNjb3BlLmF1dG9yKSB7XG4gICAgICAgIGlmICgkc2NvcGUuYXV0b3Iubm9tICE9IFwiXCIgJiYgJHNjb3BlLmF1dG9yLmNvZ25vbSAhPSBcIlwiKSB7XG4gICAgICAgICAgQXV0b3JzRmFjdG9yeS5zYXZlKCRzY29wZS5hdXRvciwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInMnaGEgZ3VhcmRhdFwiKTtcbiAgICAgICAgICAgIC8vJHNjb3BlLm5ldGVqYXJDYW1wcygpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoIFwiL2F1dG9yc1wiICk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3JcIiArIGVycm9yKTtcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgJHNjb3BlLm5ldGVqYXJDYW1wcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgJHNjb3BlLmF1dG9yID0gbnVsbDtcbiAgICB9XG4gIH0pXG4iLCJhbmd1bGFyLm1vZHVsZSgnYXBwJylcbiAgLmNvbnRyb2xsZXIoJ2xsaXN0YUF1dG9ycycsIGZ1bmN0aW9uKCRzY29wZSwgQXV0b3JzRmFjdG9yeSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uKSB7XG4gICAgJHNjb3BlLkF1dG9ycyA9IFtdO1xuICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcbiAgICAkc2NvcGUuQXV0b3JzID0gQXV0b3JzRmFjdG9yeS5xdWVyeShmdW5jdGlvbihlbnRyaWVzKSB7XG4gICAgICAkc2NvcGUuQXV0b3JzID0gZW50cmllcztcbiAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XG4gICAgfSk7XG5cbiAgICAvLyAkc2NvcGUucmVtb3ZlTGxpYnJlID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAvLyAgIGNvbnNvbGUubG9nKCRzY29wZS5jdXJyZW50VXNlcik7XG4gICAgLy8gICBpZiAoJHNjb3BlLmN1cnJlbnRVc2VyKSB7XG4gICAgLy8gICAgIGlmIChpbmRleCkge1xuICAgIC8vICAgICAgIExsaWJyZXNGYWN0b3J5LmRlbGV0ZSh7XG4gICAgLy8gICAgICAgICBpZDogJHNjb3BlLmxsaWJyZXNbaW5kZXhdLmlzYm5cbiAgICAvLyAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAvLyAgICAgICAgICRzY29wZS5sbGlicmVzLnNwbGljZShpbmRleCwgMSk7XG4gICAgLy8gICAgICAgfSlcbiAgICAvLyAgICAgfVxuICAgIC8vXG4gICAgLy8gICB9ZWxzZXtcbiAgICAvLyAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG4gICAgLy9cbiAgICAvLyAgIH1cbiAgICAvL1xuICAgIC8vIH1cbiAgICAvLyAkc2NvcGUuZWRpdGFyTGxpYnJlID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAvLyAgICRyb290U2NvcGUubGxpYnJlVG9FZGl0ID0gJHNjb3BlLmxsaWJyZXNbaW5kZXhdO1xuICAgIC8vICAgJGxvY2F0aW9uLnBhdGgoXCIvZWRpdGFybGxpYnJlXCIpO1xuICAgIC8vIH1cbiAgfSlcbiIsImFuZ3VsYXIubW9kdWxlKCdhcHAnKVxuICAuZmFjdG9yeSgnQXV0b3JzRmFjdG9yeScsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xuICAgIHJldHVybiAkcmVzb3VyY2UoXCIvYXBpL2F1dG9ycy86aWRcIiwgbnVsbCwge1xuICAgICAgJ3VwZGF0ZSc6IHtcbiAgICAgICAgbWV0aG9kOiAnUFVUJ1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==